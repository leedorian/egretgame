var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function o(e){try{c(n.next(e))}catch(t){s(t)}}function a(e){try{c(n["throw"](e))}catch(t){s(t)}}function c(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(o,a)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(o=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,s=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(n){i=[6,n],s=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,s,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},BlockBase=function(e){function t(t){var i=e.call(this)||this;i.active=!1,i._unClickableColor=RES.getRes(BlockTexture.unClickable),i._blockMargin=2,i._blockPadding=3,i._blockDisapearSpeedX=20,i._blockDisapearSpeedY=25,i._sparkSound=RES.getRes("spark_mp3"),i._movedIn=!1,i._currentState=t.state,i._coverState=t.coverState,i.shrinkRate=t.shrinkRate,i.width=t.width,i.height=t.height,i._shrinkWidth=(i.width-2*(i._blockPadding+i._blockMargin))*i.shrinkRate,i._shrinkHeight=(i.height-2*(i._blockPadding+i._blockMargin))*i.shrinkRate,i._colorRect=new egret.Bitmap,i._colorRect.width=i._shrinkWidth,i._colorRect.height=i._shrinkHeight,i._coverRect=new egret.Bitmap,i._coverRect.width=i._shrinkWidth,i._coverRect.height=i._shrinkHeight,i._coverRect.touchEnabled=!0,i._backRect=Utils.createBitmapByName("blockFrame_png");var n=new egret.Rectangle(6,6,88,106);return i._backRect.scale9Grid=n,i._backRect.width=i.width-2*i._blockMargin,i._backRect.height=i.height-2*i._blockMargin,i._backRect.x=i._blockMargin,i._backRect.y=i._blockMargin,i._backRect.touchEnabled=!0,i._beforeDraw(),i._draw(),i._colorRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onTouch,i),i._coverRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onTouch,i),i._backRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onBackTouch,i),i}return __extends(t,e),t.prototype._draw=function(){null===this._backRect.parent&&this.addChild(this._backRect);var e=Utils.blockStyle;-1!==e.indexOf("rush")?this._colorRect.texture=this._clickableRushColor:this._colorRect.texture=this._clickableColor;var t=(BlockColor.border,this._shrinkWidth),i=this._shrinkHeight;this._currentState===BlockState.unclickable&&(t=this.width-2*(this._blockMargin+this._blockPadding),i=this.height-2*(this._blockMargin+this._blockPadding)),this._currentState===BlockState.clicked&&(t=this._colorRect.width,i=this._colorRect.height),this._currentState>0?-1!==e.indexOf("rush")?this._colorRect.texture=this._clickableRushColor:this._colorRect.texture=this._clickableColor:this._colorRect.texture=this._unClickableColor,this._colorRect.x=(this.width-t)/2,this._colorRect.y=(this.height-i)/2,this._colorRect.width=t,this._colorRect.height=i,null===this._colorRect.parent&&this.addChild(this._colorRect),this._currentState!==BlockState.unclickable&&(this._coverState===BlockCoverState.freezed?this._coverRect.texture=RES.getRes("ice_png"):this._coverState===BlockCoverState.quelled?this._coverRect.texture=RES.getRes("quellEye_png"):this._coverRect.texture=null,this._coverRect.x=(this.width-t)/2,this._coverRect.y=(this.height-i)/2,this._coverRect.width=t,this._coverRect.height=i,null===this._coverRect.parent&&this.addChild(this._coverRect))},t.prototype._onTouch=function(e){this.active&&(this._currentState===BlockState.clickable?this._hit():this._currentState===BlockState.unclickable&&this._hitUnclickable())},t.prototype._onBackTouch=function(e){this.active&&this._hitUnclickable()},t.prototype._hitAni=function(){var e=this._colorRect.width*this.shrinkRate,t=this._colorRect.height*this.shrinkRate;if(this._currentState===BlockState.unclickable&&(e=this._colorRect.width,t=this._colorRect.height),e>0){var i=e-this._blockDisapearSpeedX;this._colorRect.width=i>0?i:0}if(t>0){var n=t-this._blockDisapearSpeedY;this._colorRect.height=n>0?n:0}return 0===e&&0===t?(egret.stopTick(this._hitAni,this),this.removeChild(this._colorRect)):this._draw(),!1},t.prototype._hit=function(e){var t=this;this._effectChanel=this._sparkSound.play(0,1);var i=RES.getRes("light_json"),n=RES.getRes("light_png"),r=new egret.MovieClipDataFactory(i,n),s=new egret.MovieClip(r.generateMovieClipData("light")),o=this.width/126,a=this.height/153;s.scaleX=o,s.scaleY=a,this.addChild(s),s.gotoAndPlay(0),s.addEventListener(egret.Event.COMPLETE,function(e){t.removeChild(s)},this),egret.startTick(this._hitAni,this),this.state="clicked";var c=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT);c.hitBlockType=this.blockTypeName,this.dispatchEvent(c)},t.prototype._hitUnclickable=function(){var e=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_UNCLICKABLE);this.dispatchEvent(e)},t.prototype.move=function(e,t){void 0===t&&(t="down"),this.speed=e,this._dir=t,egret.startTick(this._moveBlock,this)},t.prototype.stop=function(){egret.stopTick(this._moveBlock,this)},t.prototype.hitit=function(){this._hit(!0)},t.prototype._moveBlock=function(e){return"down"===this._dir?(this.y>=this.height&&this._triggerAllMovedInEvent(),this.y>=Utils.getArenaHeight()?this._triggerMovedOutEvent():this._setY()):(this.y<=Utils.getArenaHeight()-this.height&&this._triggerAllMovedInEvent(),this.y<=-this.height?this._triggerMovedOutEvent():this._setY()),!1},t.prototype._setY=function(){var e=this.y;"up"===this._dir?this.y=e-this.speed:this.y=e+this.speed},t.prototype._triggerMovedOutEvent=function(){var e=!1,t=new GameEvents.BlockEvent(GameEvents.BlockEvent.MOVED_OUT);this._currentState===BlockState.clickable&&(e=!0),t.missed=e,this.dispatchEvent(t)},t.prototype._triggerAllMovedInEvent=function(){if(!this._movedIn){var e=new GameEvents.BlockEvent(GameEvents.BlockEvent.ALL_MOVED_IN);this.dispatchEvent(e),this._movedIn=!0}},t.prototype.sizeUpdate=function(){this._shrinkWidth=this.width*this.shrinkRate-this._blockMargin,this._shrinkHeight=this.height*this.shrinkRate-this._blockMargin,this._currentState!==BlockState.clicked&&this._draw()},Object.defineProperty(t.prototype,"state",{get:function(){var e;return e=BlockState[this._currentState]},set:function(e){this._currentState=BlockState[e],this.graphics.clear(),this._draw()},enumerable:!0,configurable:!0}),t.prototype.freeze=function(){this._currentState!==BlockState.unclickable&&(this._coverState=BlockCoverState.freezed,this._coverRect.texture=RES.getRes("ice_png"))},t.prototype.cleanCover=function(){this._currentState!==BlockState.unclickable&&(this._coverRect.texture=null,this._coverState=BlockCoverState.normal)},t}(egret.Sprite);__reflect(BlockBase.prototype,"BlockBase");var BlockFlashBase=function(e){function t(t){var i=e.call(this,t)||this;return i._cachedClickableColor=i._clickableColor,i._cachedClickableRushColor=i._clickableRushColor,i._activeState=!0,i}return __extends(t,e),t.prototype._beforeDraw=function(){},t.prototype.move=function(t,i){void 0===i&&(i="down"),this._timeMark=egret.getTimer(),e.prototype.move.call(this,t,i)},t.prototype._moveBlock=function(t){var i=e.prototype._moveBlock.call(this,t),n=Utils.blockStyle;if("clickable"===this.state){var r=Math.floor((t-this._timeMark)/1e3);1===r&&(this._activeState=!this._activeState,this._activeState?-1!==n.indexOf("rush")?this._clickableRushColor=this._cachedClickableRushColor:this._clickableColor=this._cachedClickableColor:-1!==n.indexOf("rush")?this._clickableRushColor=RES.getRes(BlockTexture.clickableNormalRushStyle):this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._draw(),this._timeMark=t)}return i},t}(BlockBase);__reflect(BlockFlashBase.prototype,"BlockFlashBase");var MagicBase=function(e){function t(){var t=e.call(this)||this;t.qty=0,t._zoomRate=1;var i=Utils.createBitmapByName("rock_bg_png");i.scaleX=t._zoomRate,i.scaleY=t._zoomRate,t._bg=i,t._drawIcon();var n=t._getIconOffset();t.icon.x=-n.offsetX,i.y=n.offsetY,t.addChildAt(i,0),t.touchEnabled=!0;var r=Utils.createBitmapByName("unread_png");return r.scaleX=t._zoomRate,r.scaleY=t._zoomRate,t.addChild(r),r.x=i.x+i.width-25,r.y=i.y+i.height-40,t._qtyLabel=new eui.Label,t._qtyLabel.width=34,t._qtyLabel.textAlign=egret.HorizontalAlign.CENTER,t._qtyLabel.x=i.x+i.width-25,t._qtyLabel.y=i.y+i.height-35,t._qtyLabel.text="0",t.addChild(t._qtyLabel),t}return __extends(t,e),t.prototype._drawIcon=function(){},t.prototype._getIconOffset=function(){},t.prototype.enable=function(){this.touchEnabled=!0},t.prototype.disable=function(){this.touchEnabled=!1},t.prototype.getBaseWidth=function(){return this._bg.width*this._zoomRate},t.prototype.setQty=function(e){this.qty=e,this._qtyLabel.text=e.toString();var t=this.parent?this.parent.magicActive:!1;0==e?this.disable():t||this.enable()},t}(egret.Sprite);__reflect(MagicBase.prototype,"MagicBase");var MagicFreeze=function(e){function t(){var t=e.call(this)||this;return t.setQty(Service.MAGIC_CONFIG.freeze.qty),t}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("freeze_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:30,offsetY:this.icon.height*this._zoomRate-40}},t.prototype.disable=function(){e.prototype.disable.call(this),this.icon.texture=RES.getRes("freeze_disabled_png")},t.prototype.enable=function(){e.prototype.enable.call(this),this.icon.texture=RES.getRes("freeze_png")},t}(MagicBase);__reflect(MagicFreeze.prototype,"MagicFreeze");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?n(r):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BlockNormal=function(e){function t(t){var i=e.call(this,t)||this;return i.blockTypeName=BlockType.BlockNormal,i}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._clickableRushColor=RES.getRes(BlockTexture.clickableNormalRushStyle)},t}(BlockBase);__reflect(BlockNormal.prototype,"BlockNormal");var BlockRush=function(e){function t(t){var i=e.call(this,t)||this;return i.blockTypeName=BlockType.BlockRush,i}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableRushRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableRush)},t.prototype._hit=function(t){if(e.prototype._hit.call(this,t),!t&&this._activeState){var i=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_RUSH);this.dispatchEvent(i)}},t}(BlockFlashBase);__reflect(BlockRush.prototype,"BlockRush");var BlocksColumn=function(e){function t(t){var i=e.call(this)||this;return i._blocks=[],i._initialBlocks=[],i._creatingRowIndex=0,i._speedLevel=0,i._speedTick=!1,i._shrinkRate=1,i._blockCoverState=BlockCoverState.normal,i.speed=Service.GAME_CONFIG.speedLevels[i._speedLevel],i.dir=t.dir,i._dir=i.dir,i.name=t.name,i.blockWeightNumber=t.blockWeightNumber,i._speedUpInterval=1e3*t.speedUpInterval,i._index=parseInt(i.name.split("_")[1],10),i._draw(),i}return __extends(t,e),t.prototype._draw=function(){this._blocks=[],this._initialBlocks=[];for(var e="down"===this._dir?-1:0,t="down"===this._dir?Utils.rows:Utils.rows+1,i=e;t>i;i++){var n=BlockState.unclickable;this._creatingRowIndex="down"===this._dir?i+1:i,("down"===this._dir&&-1===i||"up"===this._dir&&i===t-1)&&(n=Utils.getRowBlockState(this._creatingRowIndex)[this._index]);var r=this._createBlock({state:n,startBlock:!0,coverState:this._blockCoverState});this.addChild(r),r.x=0,r.y=i*r.height,this._blocks.push(r),this._initialBlocks.push(r)}},t.prototype.reset=function(){this.stop(),this.speedLevel=0,this._blockCoverState=BlockCoverState.normal,this._dir=this.dir,this.shrinkReset();for(var e=this._blocks.length,t=0;e>t;t++)this.removeChild(this._blocks[t]),this._blocks[t]=null;this._draw()},t.prototype._createBlock=function(e){var t,i=Utils.getBlockWidth(),n=Utils.getBlockHeight(),r={width:i,height:n,shrinkRate:this._shrinkRate,state:e.state,coverState:e.coverState};if(null==e.startBlock&&e.state===BlockState.clickable)if(-1===Utils.blockStyle.indexOf("quell")){var s=[];for(var o in this._blockWeightNumber)if(this._blockWeightNumber.hasOwnProperty(o))for(var a=this._blockWeightNumber[o],c=0;a>c;c++)s.push(BlockType[o]);10!==s.length&&(s=[0,0,0,0,0,0,0,0,0,0]);var l=s,h=Math.floor(Math.random()*l.length),u=l[h];t=new window[BlockType[u]](r)}else t=new BlockNormal(r);else t=new BlockNormal(r);return e.startBlock||(t.active=!0),t.addEventListener(GameEvents.BlockEvent.MOVED_OUT,this._onMovedOut,this),t.addEventListener(GameEvents.BlockEvent.ALL_MOVED_IN,this._onAllMovedIn,this),t},t.prototype._onAllMovedIn=function(e){var t,i=e.target;i.y;if(-1!==Utils.blockStyle.indexOf("purify")&&("clickable"===i.state||i instanceof BlockBlink||i instanceof BlockShrink)){for(var n=0;n<this._blocks.length;n++)if(this._blocks[n]===i){t=n;break}i.hitit()}},t.prototype._onMovedOut=function(e){var t=e.target;e.missed;t.removeEventListener(GameEvents.BlockEvent.MOVED_OUT,this._onMovedOut,this),"down"===this._dir?this._blocks.pop():this._blocks.shift(),t.stop(),this.removeChild(t),t=null;var i=this._createBlock({state:Utils.getRowBlockState(this._creatingRowIndex)[this._index],coverState:this._blockCoverState});this._creatingRowIndex++,this.addChildAt(i,0),"down"===this._dir?i.y=this._blocks[0].y-i.height+this.speed:i.y=this._blocks[this._blocks.length-1].y+i.height-this.speed,i.move(this.speed,this._dir),"down"===this._dir?this._blocks.unshift(i):this._blocks.push(i)},t.prototype._speedLooper=function(){-1==Utils.blockStyle.indexOf("freeze")&&(this._speedTick?this._slowDown():this._speedUp())},t.prototype._speedUp=function(){this._speedLevel<Service.GAME_CONFIG.speedLevels.length&&(this._CalculateSpeed(),this.updateSpeed(),this._speedLevel++),this._speedLevel===Service.GAME_CONFIG.speedLevels.length&&(this._speedTick=!0)},t.prototype._CalculateSpeed=function(){-1!==Utils.blockStyle.indexOf("rush")?this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel]*Service.GAME_CONFIG.rushFactor:this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel]},t.prototype._slowDown=function(){this._speedLevel>0&&(this._speedLevel--,this._CalculateSpeed(),this.updateSpeed()),0===this._speedLevel&&(this._speedTick=!1,this._reversePause())},t.prototype._revertDir=function(){"up"===this._dir?this._dir="down":this._dir="up",this.move()},t.prototype._reversePause=function(){egret.startTick(this._checkPauseToFit,this)},t.prototype._checkPauseToFit=function(){var e=this._blocks.length,t=0;"down"===this._dir&&(t=e-1);var i="down"===this._dir&&this._blocks[t].y>=Utils.getArenaHeight(),n="up"===this._dir&&this._blocks[t].y<=-this._blocks[t].height;return(i||n)&&(egret.stopTick(this._checkPauseToFit,this),this._excuteReversePause()),!1},t.prototype._excuteReversePause=function(){this.stop(),console.log(this._blocks),null==this._reverseTimer&&(this._reverseTimer=new egret.Timer(2e3,1),this._reverseTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this._revertDir,this)),this._reverseTimer.reset(),this._reverseTimer.start()},t.prototype._blockSizeUpdate=function(){for(var e=0;e<this._blocks.length;e++){var t=this._blocks[e];t.shrinkRate=this._shrinkRate,t.sizeUpdate()}},t.prototype.updateSpeed=function(){for(var e=this._blocks,t=0;t<e.length;t++)e[t].speed=this.speed},t.prototype.startSpeedUpTimer=function(){this._speedUpTimer=new egret.Timer(this._speedUpInterval,0),this._speedUpTimer.addEventListener(egret.TimerEvent.TIMER,this._speedLooper,this),this._speedUpTimer.start()},t.prototype.stopSpeedUpTimer=function(){null!=this._speedUpTimer&&(this._speedUpTimer.stop(),this._speedUpTimer.removeEventListener(egret.TimerEvent.TIMER,this._speedLooper,this),this._speedUpTimer=null),this._speedTick=!1},t.prototype._stopReverseTimer=function(){null!=this._reverseTimer&&(this._reverseTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._revertDir,this),this._reverseTimer=null)},t.prototype.move=function(e){void 0===e&&(e=!1);for(var t=this._blocks,i=0;i<t.length;i++)t[i].move(this.speed,this._dir),e&&(t[i].active=!0);this.startSpeedUpTimer()},t.prototype.stop=function(e){void 0===e&&(e=!1),this.stopSpeedUpTimer(),this._stopReverseTimer(),console.log(this._blocks);for(var t=0;t<this._blocks.length;t++)this._blocks[t].stop(),e&&(this._blocks[t].active=!1)},t.prototype.shrink=function(){this._shrinkRate=.5,this._blockSizeUpdate()},t.prototype.shrinkReset=function(){this._shrinkRate=1,this._blockSizeUpdate()},Object.defineProperty(t.prototype,"speedLevel",{get:function(){return this._speedLevel},set:function(e){this._speedLevel=e,this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blockWeightNumber",{get:function(){return this._blockWeightNumber},set:function(e){this._blockWeightNumber=e},enumerable:!0,configurable:!0}),t.prototype.freezeBlocks=function(){this._blockCoverState=BlockCoverState.freezed;for(var e=this._blocks,t=0;t<e.length;t++)e[t].freeze()},t.prototype._removeEffectCover=function(){this._blockCoverState=BlockCoverState.normal;for(var e=this._blocks,t=0;t<e.length;t++)e[t].cleanCover()},t.prototype.unFreezeBlocks=function(){this._removeEffectCover()},t.prototype.unQuell=function(){this._removeEffectCover()},t.prototype.quell=function(){this._blockCoverState=BlockCoverState.quelled;for(var e=this._blocks,t=0;t<e.length;t++){var i=e[t],n=i.y;if("clickable"===i.state||i instanceof BlockBlink||i instanceof BlockShrink){i.stop(),this.removeChild(i),i=null;var r=this._createBlock({state:BlockState.clickable,coverState:BlockCoverState.quelled});this.addChild(r),r.x=0,r.y=n,r.move(this.speed,this._dir),this._blocks[t]=r}}},t.prototype.destroy=function(){for(var e=this._blocks,t=0;t<e.length;t++){var i=e[t],n=i.y;if("clickable"===i.state||i instanceof BlockBlink||i instanceof BlockShrink){i.stop(),this.removeChild(i),i=null;var r=this._createBlock({state:BlockState.unclickable});this.addChild(r),r.x=0,r.y=n,r.move(this.speed,this._dir),this._blocks[t]=r}}},t.prototype.purify=function(){for(var e=this._blocks,t=0,i=0;i<e.length;i++){var n=e[i],r=n.y;if("clickable"===n.state||n instanceof BlockBlink||n instanceof BlockShrink){n.stop(),this.removeChild(n),n=null;var s=this._createBlock({state:BlockState.unclickable});this.addChild(s),s.x=0,s.y=r,s.move(this.speed,this._dir),this._blocks[i]=s,t++}}return t},t}(egret.Sprite);__reflect(BlocksColumn.prototype,"BlocksColumn");var BlockShrink=function(e){function t(t){var i=e.call(this,t)||this;return i.blockTypeName=BlockType.BlockShrink,i}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableShrinkRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableShrink)},t.prototype._hit=function(t){if(e.prototype._hit.call(this,t),!t&&this._activeState){var i=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_SHRINK);this.dispatchEvent(i)}},t}(BlockFlashBase);__reflect(BlockShrink.prototype,"BlockShrink");var Constant=function(){function e(){}return e.getErrorDesc=function(t){var i="";switch(t){case e.ERR_LOGINED:i="已经登录";break;case e.ERR_CLOSEREG:i="关闭注册";break;case e.ERR_MOBILEERR:i="手机号错误";break;case e.ERR_MOBILECHECKERR:i="手机号校验错误";break;case e.ERR_SMSERR:i="短信验证码错误";break;case e.ERR_INVITEEMPTY:i="邀请码为空";break;case e.ERR_MOBILEEMPTY:i="手机号为空";break;case e.ERR_REGERROR:i="注册错误";break;case e.ERR_REGSENDEMAILERROR:i="注册邮箱email发送失败";break;case e.ERR_FINDPWDERROR:i="找回密码错误";break;case e.ERR_OPERATION:i="操作错误";break;case e.ERR_ACTIONPOINT_NOTENOUGH:i="行动力不足";break;case e.ERR_STARTGAME_EXCEPTION:i="开始游戏异常";break;case e.ERR_COOKIE_TIMEOUT:i="登录过期";break;case e.ERR_USERLOCK:i="被锁定的用户";break;case e.ERR_USERDENIED:i="用户禁止登陆";break;case e.ERR_NEED_EMAIL_AUTH:i="需要被邮件认证";break;case e.ERR_USERCHECKING:i="用户校验中";break;case e.ERR_LOGINERROR:i="登陆错误";break;case e.ERR_NEEDSETMODEL:i="请先设置模型";break;case e.ERR_NEEDSETPWD:i="请先设置密码";break;case e.ERR_NOLOGIN:i="未登陆";break;case e.ERR_MOBILE_EXISTS:i="手机号已经存在";break;case e.ERR_BINDFAIL:i="账号绑定失败";break;case e.ERR_GAME_TOKEN:i="token验证错误"}return i},e.getLoginUrl=function(){return e._baseURL+"index.php?m=member&f=index&v=public_thrlogin"},e.getGettokenUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=public_gettoken"},e.getUserinfoUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=getUserInfo"},e.getActionpointUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=getActionPoint"},e.getRanklistUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=scoreRankList"},e.getWeekRanklistUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=weekScoreRankList"},e.getSingleRanklistUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=singleScoreRankList"},e.getMsglistUrl=function(){return e._baseURL+"index.php?m=message&f=message&v=getMsglist"},e.getFriendlistUrl=function(){return e._baseURL+"index.php?m=game&f=friend&v=friendlist"},e.addFriendUrl=function(){return e._baseURL+"index.php?m=game&f=friend&v=addFriend"},e.applyFriendUrl=function(){return e._baseURL+"index.php?m=game&f=friend&v=applyFriend"},e.searchUserUrl=function(){return e._baseURL+"index.php?m=member&f=index&v=searchUser"},e.getFriendApplyList=function(){return e._baseURL+"index.php?m=game&f=friend&v=getFriendApplyList"},e.getUpinfoUrl=function(){return e._baseURL+"index.php?m=member&f=index&v=upinfo"},e.getPropListUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=getPropList"},e.getMyProlist=function(){return e._baseURL+"index.php?m=game&f=index&v=getMyProlist"},e.getBuyPropUrl=function(){return e._baseURL+"index.php?m=game&f=index&v=onlybuyGameProp"},e.giveActionPointUrl=function(){return e._baseURL+"index.php?m=game&f=friend&v=giveActionPoint"},e._baseURL="https://game.weiplus5.com/",e.G_UID_KEY="G_UID_KEY",e.G_NICKNAME_KEY="G_NICKNAME_KEY",e.G_UNAME_KEY="G_UNAME_KEY",e.G_USEREXPIRETIME_KEY="G_USEREXPIRETIME_KEY",e.G_OPENID_KEY="G_OPENID_KEY",e.G_TOKEN_KEY="G_TOKEN_KEY",e.G_TOKEN_EXPIRE_KEY="G_TOKEN_EXPIRE_KEY",e.G_SEARCHUSER_KEY="G_SEARCHUSER_KEY",e.G_FIRST_LOOKDATE="G_FIRST_LOOKDATE",e.G_MUSIC_DEFAULTVAL=100,e.G_MUSIC_VAL_KEY="G_MUSIC_VAL_KEY",e.G_MUSIC_STATE_KEY="G_MUSIC_STATE_KEY",e.ERR_LOGINED=-214,e.ERR_CLOSEREG=-215,e.ERR_MOBILEERR=-216,e.ERR_MOBILECHECKERR=-217,e.ERR_SMSERR=-218,e.ERR_INVITEEMPTY=-220,e.ERR_MOBILEEMPTY=-221,e.ERR_REGERROR=-222,e.ERR_REGSENDEMAILERROR=-224,e.ERR_FINDPWDERROR=-225,e.ERR_OPERATION=-226,e.ERR_ACTIONPOINT_NOTENOUGH=-227,e.ERR_STARTGAME_EXCEPTION=-228,e.ERR_COOKIE_TIMEOUT=-230,e.ERR_USERLOCK=-231,e.ERR_USERDENIED=-232,e.ERR_NEED_EMAIL_AUTH=-233,e.ERR_USERCHECKING=-234,e.ERR_LOGINERROR=-235,e.ERR_NEEDSETMODEL=-236,e.ERR_NEEDSETPWD=-237,e.ERR_NOLOGIN=-238,e.ERR_MOBILE_EXISTS=-239,e.ERR_BINDFAIL=-1e3,e.ERR_GAME_TOKEN=-1001,e.DESIGN_WID=1920,e.DESIGN_HEI=1080,e.isdebug=!0,e}();__reflect(Constant.prototype,"Constant");var BlockState;!function(e){e[e.unclickable=0]="unclickable",e[e.clicked=1]="clicked",e[e.clickable=2]="clickable",e[e.clickableDouble=3]="clickableDouble",e[e.clickableRush=4]="clickableRush"}(BlockState||(BlockState={}));var BlockColor;!function(e){e[e.unClickable=16777215]="unClickable",e[e.clickable=0]="clickable",e[e.clicked=15066597]="clicked",e[e.border=6710886]="border",e[e.clickableDouble=1782970]="clickableDouble",e[e.clickableRush=12000541]="clickableRush",e[e.clickableBlink=9688320]="clickableBlink",e[e.clickableShrink=13172991]="clickableShrink"}(BlockColor||(BlockColor={}));var BlockTexture;!function(e){e.unClickable="b_normal_png",e.clicked="block_clicked",e.clickableDouble="b_blue_png",e.clickableRush="b_red_png",e.clickableBlink="b_yellow_png",e.clickableShrink="b_purple_png",e.clickableNormal="b_black_png",e.clickableNormalRushStyle="b_black_rush_png",e.clickableShrinkRushStyle="b_purple_rush_png",e.clickableBlinkRushStyle="b_yellow_rush_png",e.clickableRushRushStyle="b_red_rush_png",e.clickableDoubleRushStyle="b_blue_rush_png"}(BlockTexture||(BlockTexture={}));var BlockType;!function(e){e[e.BlockNormal=0]="BlockNormal",e[e.BlockDouble=1]="BlockDouble",e[e.BlockRush=2]="BlockRush",e[e.BlockBlink=3]="BlockBlink",e[e.BlockShrink=4]="BlockShrink",e[e.BlockBonus=5]="BlockBonus"}(BlockType||(BlockType={}));var BlockStyle;!function(e){e[e.Default=0]="Default",e[e.Rush=1]="Rush"}(BlockStyle||(BlockStyle={}));var GameMode;!function(e){e[e.BI_DIR=0]="BI_DIR",e[e.DOWN=1]="DOWN",e[e.UP=2]="UP"}(GameMode||(GameMode={}));var GameLevel;!function(e){e[e.EASY=0]="EASY",e[e.NORMAL=1]="NORMAL",e[e.HARD=2]="HARD"}(GameLevel||(GameLevel={}));var TextColors;!function(e){e[e.defaultButtonLable=16777215]="defaultButtonLable"}(TextColors||(TextColors={}));var BlockCoverState;!function(e){e[e.normal=0]="normal",e[e.freezed=1]="freezed",e[e.quelled=2]="quelled"}(BlockCoverState||(BlockCoverState={}));var GameEvents;!function(e){var t=function(e){function t(t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1);var r=e.call(this,t,i,n)||this;return r.missed=!1,r}return __extends(t,e),t.MOVED_OUT="movedout",t.ALL_MOVED_IN="allmovedin",t.MISSED="missed",t.HIT="hit",t.HIT_RUSH="hitrush",t.HIT_SHRINK="hitshrink",t.HIT_UNCLICKABLE="hitunclickable",t}(egret.Event);e.BlockEvent=t,__reflect(t.prototype,"GameEvents.BlockEvent");var i=function(e){function t(t,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1);var r=e.call(this,t,i,n)||this;return r.score=0,r}return __extends(t,e),t.GAME_OVER="gameover",t.SCORE="score",t}(egret.Event);e.PlayEvent=i,__reflect(i.prototype,"GameEvents.PlayEvent");var n=function(e){function t(t,i,n){return void 0===i&&(i=!0),void 0===n&&(n=!1),e.call(this,t,i,n)||this}return __extends(t,e),t.UNFREEZE="unfreeze",t.UNQUELL="unquell",t.UNPURIFY="unpurify",t.DESTROY="destroy",t}(egret.Event);e.MagicEvent=n,__reflect(n.prototype,"GameEvents.MagicEvent")}(GameEvents||(GameEvents={}));var Friend=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.back.touchEnabled=!0,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToIndex,this),this.friendSearch.touchEnabled=!0,this.friendSearch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.searchUser,this),this.loadFriendList(),this.loadApplyList()},t.prototype.searchUser=function(){console.log("searchUser.......................");var e=this.searchkey.text;if(null!=e&&""!=e){egret.localStorage.setItem(Constant.G_SEARCHUSER_KEY,this.searchkey.text);var t=new GameEvent(GameEvent.GAME_SEARCHFRIEND);this.dispatchEvent(t)}else Toast.launch("请输入用户检索关键字..")},t.prototype.backToIndex=function(){var e=new GameEvent(GameEvent.GAME_INDEX);this.dispatchEvent(e)},t.prototype.loadApplyList=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget;console.log(i.response);var n=JSON.parse(i.response);if(0==n.status){var r=Number(n.count);if(e.reqlabel.text=r+"个好友请求",r>0){r>5&&(r=5);for(var s=0;r>s;s++){var o=n.rows[s].avater,a=new eui.Image,c=new egret.ImageLoader;c.crossOrigin="anonymous",c.load(o),c.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){var t=new egret.Texture;t.bitmapData=e.currentTarget.data,a.source=t}},this),a.x=58+100*s,a.y=428,a.width=90,a.height=90,e.addChild(a)}}}else console.log("loadApplyList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getFriendApplyList();n=n+"&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.loadFriendList=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget;console.log(i.response);var n=JSON.parse(i.response);if(0==n.status){var r=Number(n.count);if(r>0){e.datalist.dataProvider=new eui.ArrayCollection(n.rows),e.datalist.itemRenderer=FriendListIRSkin}}else console.log("loadList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getFriendlistUrl();n=n+"&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t}(eui.Component);__reflect(Friend.prototype,"Friend",["eui.UIComponent","egret.DisplayObject"]);var FriendListIRSkin=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/Frienditem.exml",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this,t=new egret.ImageLoader;t.crossOrigin="anonymous",t.load(this.data.avater),t.once(egret.Event.COMPLETE,function(t){if(t.currentTarget.data){var i=new egret.Texture;i.bitmapData=t.currentTarget.data,e.avater.source=i}},this),this.rank.text=this.data.n,this.score.text=this.data.totalscore,this.nickname.text=this.data.truename,null==this.data.giftuid||"null"==this.data.giftuid||""==this.data.giftuid?(this.sendactionpointBtn.texture=RES.getRes("actionpoint_send_on_png"),this.sendactionpointBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendActionPorint,this)):this.sendactionpointBtn.texture=RES.getRes("actionpoint_send_off_png")},t.prototype.sendActionPorint=function(){var e=this.data.touid,t=this,i=new egret.HttpRequest,n=function(e){switch(e.type){case egret.Event.COMPLETE:var i=e.currentTarget;console.log(i.response);var n=JSON.parse(i.response);0==n.status?(t.sendactionpointBtn.texture=RES.getRes("actionpoint_send_off_png"),t.sendactionpointBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,null,this),Toast.launch("赠送成功")):console.log("loadList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};i.once(egret.Event.COMPLETE,n,t),i.once(egret.IOErrorEvent.IO_ERROR,n,t);var r=Constant.giveActionPointUrl();r=r+"&touid="+e+"&"+WxgUtils.getTokenParam(),console.log("#"+r),i.open(r,egret.HttpMethod.GET),i.send()},t}(eui.ItemRenderer);__reflect(FriendListIRSkin.prototype,"FriendListIRSkin");var GameEvent=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.GAME_OVER="game_over_event",t.GAME_HIT="game_hit_event",t.GAME_START="game_start_event",t.GAME_GO="game_go_event",t.GAME_CONTINUE="game_continue_event",t.GAME_BLEED="game_bleed_event",t.GAME_HELP="game_help_event",t.GAME_RANK="game_rank_event",t.GAME_HINT="game_hint_event",t.GAME_TORANK="game_torank_event",t.GAME_INDEX="game_index_event",t.GAME_MESSAGE="game_message",t.GAME_FRIEND="game_friend_event",t.GAME_SEARCHFRIEND="game_searchfriend_event",t.GAME_SETTING="game_setting_event",t.GAME_SHOPSKILL="game_shopskill_event",t}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var GameScene=function(e){function t(t){var i=e.call(this)||this;return i._blockColumns=[],i._columnSpeeds=[],i._difficulty=0,i._bgm=RES.getRes("midnight-ride_mp3"),i._freezeSound=RES.getRes("iceCracking_mp3"),i._windSound=RES.getRes("wind_mp3"),i._quellSound=RES.getRes("quell_mp3"),i._purifySound=RES.getRes("Purify_mp3"),i._purifyingSound=RES.getRes("Purifying_mp3"),i._destroySound=RES.getRes("Destroy1_mp3"),i.started=!1,i._mode=t.mode,i._level=t.level,i._rushFactor=Service.GAME_CONFIG.rushFactor,i._rushTime=Service.GAME_CONFIG.rushTime,i._shrinkTime=Service.GAME_CONFIG.shrinkTime,i._levelUpTime=Service.GAME_CONFIG.levelUpInterval,i._calculateColsRows(),i._drawColumns(),i.width=Utils.getArenaWidth(),i.height=Utils.getArenaHeight(),i.scrollRect=new egret.Rectangle(0,0,i.width,i.height),i.addEventListener(GameEvents.BlockEvent.MOVED_OUT,i._onMovedOut,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_RUSH,i._onHitRush,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_UNCLICKABLE,i._onHitUnclickable,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_SHRINK,i._onHitShrink,i,!0),document.addEventListener("pause",i._onPause.bind(i),!1),document.addEventListener("resume",i._onResume.bind(i),!1),i
}return __extends(t,e),t.prototype._onPause=function(){this._stopbgm(),this._effectChanel.stop()},t.prototype._onResume=function(){this.started&&this._playbgm(),-1!==Utils.blockStyle.indexOf("freeze")&&this._freezeSound.play(0,0),-1!==Utils.blockStyle.indexOf("quell")&&this._quellSound.play(0,0)},t.prototype._drawColumns=function(){for(var e,t=["up","down"],i=Utils.getBlockWidth(),n=0;n<Utils.columns;n++){var r="up";this._mode===GameMode.BI_DIR?r=t[Math.floor(2*Math.random())]:this._mode===GameMode.DOWN&&(r=t[1]),e=new BlocksColumn({dir:r,speedUpInterval:Service.GAME_CONFIG.colmuns[n].interval,name:"col_"+n,blockWeightNumber:Service.GAME_CONFIG.difficulty[this._difficulty]}),e.x=n*i,e.width=i,this.addChildAt(e,1),this._blockColumns.push(e)}},t.prototype._calculateColsRows=function(){Utils.columns=4,Utils.rows=5},t.prototype._onMovedOut=function(e){var t=(e.target,e.missed);t&&this._gameOver()},t.prototype._onHitRush=function(e){if(null==this._rushWatch){this._rushWatch=new Time.StopWatch({times:this._rushTime,finish:this._stopRush},this),-1==Utils.blockStyle.indexOf("freeze")&&(this._columnSpeeds=[]);for(var t=0;t<this._blockColumns.length;t++)if(-1==Utils.blockStyle.indexOf("freeze")){var i=this._blockColumns[t].speed;this._columnSpeeds.push(i),this._blockColumns[t].speed=i*this._rushFactor,this._blockColumns[t].updateSpeed()}}this._rushWatch.run();Utils.blockStyle=Utils.blockStyle+"rush"},t.prototype._stopRush=function(){if(-1==Utils.blockStyle.indexOf("freeze"))for(var e=0;e<this._blockColumns.length;e++){var t=this._columnSpeeds[e];this._blockColumns[e].speed=t,this._blockColumns[e].updateSpeed()}this._rushWatch=null,Utils.blockStyle=Utils.blockStyle.replace(/rush/g,"")},t.prototype._onHitUnclickable=function(){this._gameOver()},t.prototype._onHitShrink=function(){if(null==this._shrinkWatch){this._shrinkWatch=new Time.StopWatch({times:this._shrinkTime,finish:this._stopShrink},this);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].shrink()}this._shrinkWatch.run()},t.prototype._stopShrink=function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].shrinkReset();this._shrinkWatch=null},t.prototype.gameStart=function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].move(!0);this._startLevelUp(),this._playbgm(),this.started=!0,Service.gameStart()},t.prototype._gameOver=function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].stop(!0);var t=new GameEvents.PlayEvent(GameEvents.PlayEvent.GAME_OVER);this.dispatchEvent(t),this._stopbgm(),this._stopeffect(),this.started=!1,Utils.blockStyle=""},t.prototype._startLevelUp=function(){null==this._levelUpWatch&&(this._levelUpWatch=new Time.StopWatch({times:Service.GAME_CONFIG.difficulty.length,finish:this._stopLevelUp,interval:this._levelUpTime,tick:this.levelUp},this));this._levelUpWatch.run()},t.prototype._stopLevelUp=function(){this._levelUpWatch=null},t.prototype.levelUp=function(e){this._difficulty<Service.GAME_CONFIG.difficulty.length-1&&this._difficulty++,console.log(this._difficulty);for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].blockWeightNumber=Service.GAME_CONFIG.difficulty[this._difficulty]},t.prototype.getLevel=function(){return this._difficulty},t.prototype._playbgm=function(){this._bgmChanel=this._bgm.play(0,0)},t.prototype._stopbgm=function(){this._bgmChanel.stop()},t.prototype._stopeffect=function(){this._effectChanel&&this._effectChanel.stop()},t.prototype.reset=function(e){void 0===e&&(e=!1),this._difficulty=0,Utils.rowsState={};for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].blockWeightNumber=Service.GAME_CONFIG.difficulty[this._difficulty],this._blockColumns[t].reset();e||(null!=this._rushWatch&&(this._rushWatch.destroy(),this._rushWatch=null),null!=this._freezeWatch&&(this._freezeWatch.destroy(),this._freezeWatch=null),null!=this._quellWatch&&(this._quellWatch.destroy(),this._quellWatch=null),null!=this._purifyWatch&&(this._purifyWatch.destroy(),this._purifyWatch=null),null!=this._destroyWatch&&(this._destroyWatch.destroy(),this._destroyWatch=null),null!=this._shrinkWatch&&(this._shrinkWatch.destroy(),this._shrinkWatch=null),null!=this._levelUpWatch&&(this._levelUpWatch.destroy(),this._levelUpWatch=null),Utils.blockStyle="")},t.prototype._resetSpeed=function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].reset(),this._blockColumns[e].updateSpeed(),this._blockColumns[e].move(!0)},t.prototype._pauseMove=function(e,t){for(var i=0;i<this._blockColumns.length;i++)this._blockColumns[i].stop(!0);var n=new Time.Timer(e,function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].move(!0);t.call(this)},this);n.run()},t.prototype._unFreeze=function(){this._effectChanel.stop();for(var e=0;e<this._blockColumns.length;e++){var t=this._columnSpeeds[e];this._blockColumns[e].speed=t,this._blockColumns[e].updateSpeed(),this._blockColumns[e].unFreezeBlocks()}Utils.blockStyle=Utils.blockStyle.replace(/freeze/g,""),this._freezeWatch=null;var i=new GameEvents.MagicEvent(GameEvents.MagicEvent.UNFREEZE);this.dispatchEvent(i)},t.prototype.freeze=function(){this._effectChanel=this._windSound.play(0,1),this._pauseMove(4e3,function(){if(this._effectChanel=this._freezeSound.play(0,0),null==this._freezeWatch){this._freezeWatch=new Time.StopWatch({times:this._rushTime,finish:this._unFreeze},this),this._columnSpeeds=[];for(var e=0;e<this._blockColumns.length;e++){var t=this._blockColumns[e].speed;this._columnSpeeds.push(t),this._blockColumns[e].speed=1,this._blockColumns[e].updateSpeed(),this._blockColumns[e].freezeBlocks()}}this._freezeWatch.run()})},t.prototype._unQuell=function(){this._effectChanel.stop();for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].unQuell();Utils.blockStyle=Utils.blockStyle.replace(/quell/g,""),this._quellWatch=null;var t=new GameEvents.MagicEvent(GameEvents.MagicEvent.UNQUELL);this.dispatchEvent(t)},t.prototype.quell=function(){this._effectChanel=this._quellSound.play(0,0),this._pauseMove(5100,function(){if(null==this._quellWatch){this._quellWatch=new Time.StopWatch({times:this._rushTime,finish:this._unQuell},this);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].quell()}this._quellWatch.run()})},t.prototype.purify=function(e){this._effectChanel=this._purifySound.play(0,1),this._pauseMove(5e3,function(){if(this._effectChanel=this._purifyingSound.play(0,0),null==this._purifyWatch){this._purifyWatch=new Time.StopWatch({times:this._rushTime,finish:this._unPurify},this);for(var t=0,i=0;i<this._blockColumns.length;i++)t+=this._blockColumns[i].purify();e.score=e.score+t}this._purifyWatch.run()})},t.prototype._unPurify=function(){this._effectChanel.stop(),Utils.blockStyle=Utils.blockStyle.replace(/purify/g,""),this._purifyWatch=null;var e=new GameEvents.MagicEvent(GameEvents.MagicEvent.UNPURIFY);this.dispatchEvent(e)},t.prototype.destroy=function(){this._effectChanel=this._destroySound.play(0,1),this._pauseMove(5e3,function(){if(null==this._destroyWatch){this._destroyWatch=new Time.StopWatch({times:3,finish:this._unDestroy},this);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].destroy();this._resetSpeed()}this._destroyWatch.run()})},t.prototype._unDestroy=function(){this._effectChanel.stop(),Utils.blockStyle=Utils.blockStyle.replace(/destroy/g,""),this._destroyWatch=null;var e=new GameEvents.MagicEvent(GameEvents.MagicEvent.DESTROY);this.dispatchEvent(e)},t}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");var GameScreen=function(e){function t(t){void 0===t&&(t={});var i=e.call(this)||this;return i.magicActive=!1,i._FreezeEffectMCs=[],i._QuellEffectMCs=[],i._PurifyEffectMCs=[],i._DestroyEffectMCs=[],i._drawBg(),i._drawGameScene(),i._drawScore(),i._drawMagics(),i.addEventListener(GameEvents.BlockEvent.HIT,i._onHit,i,!0),i.addEventListener(GameEvents.PlayEvent.GAME_OVER,i._gameOver,i),i.addEventListener(GameEvents.MagicEvent.UNFREEZE,i._enableMagic,i),i.addEventListener(GameEvents.MagicEvent.UNQUELL,i._enableMagic,i),i.addEventListener(GameEvents.MagicEvent.UNPURIFY,i._enableMagic,i),i.addEventListener(GameEvents.MagicEvent.DESTROY,i._enableMagic,i),i.addEventListener(GameEvents.PlayEvent.SCORE,i._onMagicScore,i,!0),i}return __extends(t,e),t.prototype._drawBg=function(){this._bg=Utils.createBitmapByName("bg_png");var e=Utils.getStageWidth(),t=Utils.getStageHeight(),i=e/this._bg.texture.bitmapData.width,n=t/this._bg.texture.bitmapData.height;this._bg.width=e,this._bg.height=t,this.addChild(this._bg);var r=RES.getRes("shanguang_json"),s=RES.getRes("shanguang_png"),o=new egret.MovieClipDataFactory(r,s),a=new egret.MovieClip(o.generateMovieClipData("shanguang"));a.x=425*i,a.y=1415*n,a.scaleX=i,a.scaleY=n,this.addChild(a),a.gotoAndPlay("shan",-1)},t.prototype._drawGameScene=function(){var e=new GameScene({mode:GameMode.DOWN,level:GameLevel.EASY});this._gameScene=e,this._gameScene.x=(Utils.getStageWidth()-Utils.getArenaWidth())/2,this._gameScene.y=Utils.verticalMarginTop,this.addChild(e)},t.prototype._drawMagics=function(){var e=0;this._magicFreeze=new MagicFreeze;var t=this._magicFreeze.getBaseWidth(),i=(Utils.getStageWidth()-2*Utils.horizontalMargin-4*t)/3;this._magicFreeze.anchorOffsetY=this._magicFreeze.height,this._magicFreeze.x=e*(i+t)+Utils.horizontalMargin,this._magicFreeze.y=Utils.getStageHeight()-20,this.addChild(this._magicFreeze),this._magicFreeze.addEventListener(egret.TouchEvent.TOUCH_TAP,this._freeze,this),e++,this._magicQuell=new MagicQuell,this._magicQuell.anchorOffsetY=this._magicQuell.height,this._magicQuell.x=e*(i+t)+Utils.horizontalMargin,this._magicQuell.y=Utils.getStageHeight()-20,this.addChild(this._magicQuell),this._magicQuell.addEventListener(egret.TouchEvent.TOUCH_TAP,this._quell,this),e++,this._magicPurify=new MagicPurify,this._magicPurify.anchorOffsetY=this._magicPurify.height,this._magicPurify.x=e*(i+t)+Utils.horizontalMargin,this._magicPurify.y=Utils.getStageHeight()-20,this.addChild(this._magicPurify),this._magicPurify.addEventListener(egret.TouchEvent.TOUCH_TAP,this._purify,this),e++,this._magicDestroy=new MagicDestroy,this._magicDestroy.anchorOffsetY=this._magicDestroy.height,this._magicDestroy.x=e*(i+t)+Utils.horizontalMargin,this._magicDestroy.y=Utils.getStageHeight()-20,this.addChild(this._magicDestroy),this._magicDestroy.addEventListener(egret.TouchEvent.TOUCH_TAP,this._destroy,this)},t.prototype._onHit=function(e){e.hitBlockType===BlockType.BlockNormal?(this._score.score=this._score.score+parseInt(Service.GAME_CONFIG.blockScoreArr.block_score_black,10),this._score.BlockNormalNumber++):e.hitBlockType===BlockType.BlockRush?(this._score.score=this._score.score+parseInt(Service.GAME_CONFIG.blockScoreArr.block_score_red,10),this._score.BlockRushNumber++):e.hitBlockType===BlockType.BlockDouble?(this._score.score=this._score.score+parseInt(Service.GAME_CONFIG.blockScoreArr.block_score_blue,10),this._score.BlockDoubleNumber++):e.hitBlockType===BlockType.BlockShrink&&(this._score.score=this._score.score+parseInt(Service.GAME_CONFIG.blockScoreArr.block_score_purple,10),this._score.BlockShrinkNumber++)},t.prototype._drawScore=function(){this._score=new Score,this.addChild(this._score)},t.prototype._gameOver=function(){console.log(this._score.score),Service.gameScore({level:this._gameScene.getLevel(),score:this._score})},t.prototype._handleMagicsState=function(e){e?this.magicActive=!1:this.magicActive=!0;for(var t=[this._magicFreeze,this._magicQuell,this._magicPurify,this._magicDestroy],i=t.length,n=0;i>n;n++)e&&t[n].qty>0?t[n].enable():t[n].disable()},t.prototype._setEffectMCSize=function(e){var t=Utils.getStageWidth(),i=Utils.getStageHeight(),n=t/500,r=i/889;e.scaleX=n,e.scaleY=r},t.prototype._concatenateClips=function(e){for(var t=this,i=e.length,n=function(){var n=e[s+1],o=e[s],a=s;o.addEventListener(egret.Event.COMPLETE,function(e){t.removeChild(o),i-1>a&&(t.addChild(n),n.gotoAndPlay(0))},r)},r=this,s=0;i>s;s++)n()},t.prototype._createEffectClips=function(e,t){for(var i=[],n=1;t>=n;n++){var r=RES.getRes(e+n+"_json"),s=RES.getRes(e+n+"_png"),o=new egret.MovieClipDataFactory(r,s),a=new egret.MovieClip(o.generateMovieClipData(e));this._setEffectMCSize(a),i.push(a)}return i},t.prototype._freeze=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return Service.MAGIC_CONFIG.freeze.qty>0&&this._gameScene.started&&-1===Utils.blockStyle.indexOf("freeze")?(Utils.blockStyle=Utils.blockStyle+"freeze",this._handleMagicsState(),0===this._FreezeEffectMCs.length&&(this._FreezeEffectMCs=this._createEffectClips("FreezeA",6),this._concatenateClips(this._FreezeEffectMCs)),this.addChild(this._FreezeEffectMCs[0]),this._FreezeEffectMCs[0].gotoAndPlay(0),this._gameScene.freeze(),[4,Service.useMagic({id:Service.MAGIC_CONFIG.freeze.id,name:"freeze"})]):[3,2];case 1:e=t.sent(),this._magicFreeze.setQty(e),t.label=2;case 2:return[2]}})})},t.prototype._enableMagic=function(){this._handleMagicsState(!0)},t.prototype._quell=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return Service.MAGIC_CONFIG.quell.qty>0&&this._gameScene.started&&-1===Utils.blockStyle.indexOf("quell")?(Utils.blockStyle=Utils.blockStyle+"quell",this._handleMagicsState(),0===this._QuellEffectMCs.length&&(this._QuellEffectMCs=this._createEffectClips("QuellA",10),this._concatenateClips(this._QuellEffectMCs)),this.addChild(this._QuellEffectMCs[0]),this._QuellEffectMCs[0].gotoAndPlay(0),this._gameScene.quell(),[4,Service.useMagic({id:Service.MAGIC_CONFIG.quell.id,name:"quell"})]):[3,2];case 1:e=t.sent(),this._magicQuell.setQty(e),t.label=2;case 2:return[2]}})})},t.prototype._purify=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return Service.MAGIC_CONFIG.purify.qty>0&&this._gameScene.started&&-1===Utils.blockStyle.indexOf("purify")?(Utils.blockStyle=Utils.blockStyle+"purify",this._handleMagicsState(),0===this._PurifyEffectMCs.length&&(this._PurifyEffectMCs=this._createEffectClips("PurifyA",17),this._concatenateClips(this._PurifyEffectMCs)),this.addChild(this._PurifyEffectMCs[0]),this._PurifyEffectMCs[0].gotoAndPlay(0),this._gameScene.purify(this._score),[4,Service.useMagic({id:Service.MAGIC_CONFIG.purify.id,name:"purify"})]):[3,2];case 1:e=t.sent(),this._magicPurify.setQty(e),t.label=2;case 2:return[2]}})})},t.prototype._destroy=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return Service.MAGIC_CONFIG.destroy.qty>0&&this._gameScene.started&&-1===Utils.blockStyle.indexOf("destroy")?(Utils.blockStyle=Utils.blockStyle+"destroy",this._handleMagicsState(),0===this._DestroyEffectMCs.length&&(this._DestroyEffectMCs=this._createEffectClips("DestroyA",5),this._concatenateClips(this._DestroyEffectMCs)),this.addChild(this._DestroyEffectMCs[0]),this._DestroyEffectMCs[0].gotoAndPlay(0),this._gameScene.destroy(),[4,Service.useMagic({id:Service.MAGIC_CONFIG.destroy.id,name:"destroy"})]):[3,2];case 1:e=t.sent(),this._magicDestroy.setQty(e),t.label=2;case 2:return[2]}})})},t.prototype._onMagicScore=function(e){var t=e.score;this._score.score=this._score.score+t},t.prototype.reset=function(){this._score.reset(),this._gameScene.reset(),this._handleMagicsState(!0)},Object.defineProperty(t.prototype,"gameScene",{get:function(){return this._gameScene},enumerable:!0,configurable:!0}),t}(egret.Sprite);__reflect(GameScreen.prototype,"GameScreen");var Index=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=(Utils.getStageWidth(),Utils.getStageHeight(),new Indexcon);this.addChild(e);var t=new Usertop;this.addChild(t)},t}(egret.Sprite);__reflect(Index.prototype,"Index");var Indexcon=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.playgame.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.playgameBtnCallback,this),this.playgame.addEventListener(egret.TouchEvent.TOUCH_END,this.playgameBtnCallback,this),this.playgame.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.playgameBtnCallback,this),this.rankImg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.rankBtnCallback,this),this.rankImg.addEventListener(egret.TouchEvent.TOUCH_END,this.rankBtnCallback,this),this.rankImg.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.rankBtnCallback,this),this.settingImg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.settingBtnCallback,this),this.settingImg.addEventListener(egret.TouchEvent.TOUCH_END,this.settingBtnCallback,this),this.settingImg.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.settingBtnCallback,this),this.faceImg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.faceBtnCallback,this),this.faceImg.addEventListener(egret.TouchEvent.TOUCH_END,this.faceBtnCallback,this),this.faceImg.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.faceBtnCallback,this),this.scoreImg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.msgBtnCallback,this),this.scoreImg.addEventListener(egret.TouchEvent.TOUCH_END,this.msgBtnCallback,this),this.scoreImg.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.msgBtnCallback,this)},t.prototype.msgBtnCallback=function(e){if(e.type==egret.TouchEvent.TOUCH_BEGIN)e.currentTarget.scaleX=1.05,e.currentTarget.scaleY=1.05;else if(e.type==egret.TouchEvent.TOUCH_END){e.currentTarget.scaleX=1,e.currentTarget.scaleY=1;var t=new GameEvent(GameEvent.GAME_MESSAGE);this.dispatchEvent(t)}else e.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE&&(e.currentTarget.scaleX=1,e.currentTarget.scaleY=1)},t.prototype.faceBtnCallback=function(e){if(e.type==egret.TouchEvent.TOUCH_BEGIN)e.currentTarget.scaleX=1.05,e.currentTarget.scaleY=1.05;else if(e.type==egret.TouchEvent.TOUCH_END){e.currentTarget.scaleX=1,e.currentTarget.scaleY=1;var t=new GameEvent(GameEvent.GAME_FRIEND);this.dispatchEvent(t)}else e.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE&&(e.currentTarget.scaleX=1,e.currentTarget.scaleY=1)},t.prototype.settingBtnCallback=function(e){if(console.log("settingBtnCallback......."),e.type==egret.TouchEvent.TOUCH_BEGIN)e.currentTarget.scaleX=1.05,e.currentTarget.scaleY=1.05;else if(e.type==egret.TouchEvent.TOUCH_END){e.currentTarget.scaleX=1,e.currentTarget.scaleY=1;var t=new GameEvent(GameEvent.GAME_SETTING);this.dispatchEvent(t)}else e.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE&&(e.currentTarget.scaleX=1,e.currentTarget.scaleY=1)},t.prototype.rankBtnCallback=function(e){if(console.log("rankBtnCallback......."),e.type==egret.TouchEvent.TOUCH_BEGIN)e.currentTarget.scaleX=1.05,e.currentTarget.scaleY=1.05;else if(e.type==egret.TouchEvent.TOUCH_END){e.currentTarget.scaleX=1,e.currentTarget.scaleY=1;var t=new GameEvent(GameEvent.GAME_RANK);this.dispatchEvent(t)}else e.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE&&(e.currentTarget.scaleX=1,e.currentTarget.scaleY=1)},t.prototype.playgameBtnCallback=function(e){if(console.log("playgameBtnCallback..............."),e.type==egret.TouchEvent.TOUCH_BEGIN)e.currentTarget.scaleX=1.05,e.currentTarget.scaleY=1.05;else if(e.type==egret.TouchEvent.TOUCH_END){e.currentTarget.scaleX=1,e.currentTarget.scaleY=1;var t=new GameEvent(GameEvent.GAME_START);this.dispatchEvent(t)}else e.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE&&(e.currentTarget.scaleX=1,e.currentTarget.scaleY=1)},t}(eui.Component);__reflect(Indexcon.prototype,"Indexcon",["eui.UIComponent","egret.DisplayObject"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.textField.fontFamily="Ngaan",this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading resources..."+e+"/"+t},t.prototype.onRemoteProgress=function(e,t){this.textField.text="Loading configuration..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Login=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.WechatLoginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("点击了微信登录按钮........."),egret.ExternalInterface.call("sendToNative","wxlogin")},this),this.GoogleLoginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("点击了Goolge登录按钮........."),egret.ExternalInterface.call("sendToNative","googlelogin")},this)},t}(eui.Component);__reflect(Login.prototype,"Login",["eui.UIComponent","egret.DisplayObject"]);var BlockBlink=function(e){function t(t){var i=e.call(this,t)||this;return i._activeState=!0,i.blockTypeName=BlockType.BlockBlink,i}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableBlinkRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableBlink)},t.prototype.move=function(t,i){void 0===i&&(i="down"),this._timeMark=egret.getTimer(),e.prototype.move.call(this,t,i)},t.prototype._moveBlock=function(t){var i=e.prototype._moveBlock.call(this,t);if("clicked"!==this.state){var n=Math.floor((t-this._timeMark)/1e3);1===n&&(this._activeState=!this._activeState,this._activeState?this.state="clickable":this.state="unclickable",this._timeMark=t)}return i},t}(BlockBase);__reflect(BlockBlink.prototype,"BlockBlink");var MagicDestroy=function(e){function t(){var t=e.call(this)||this;return t.setQty(Service.MAGIC_CONFIG.destroy.qty),t}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("nuke_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:30,offsetY:this.icon.height*this._zoomRate-30}},t.prototype.disable=function(){e.prototype.disable.call(this),this.icon.texture=RES.getRes("nuke_disabled_png")},t.prototype.enable=function(){e.prototype.enable.call(this),this.icon.texture=RES.getRes("nuke_png")},t}(MagicBase);__reflect(MagicDestroy.prototype,"MagicDestroy");var BlockDouble=function(e){function t(t){var i=e.call(this,t)||this;return i._clickCount=0,i.blockTypeName=BlockType.BlockDouble,i}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableDoubleRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableDouble)},t.prototype._onTouch=function(e){var t=Utils.blockStyle;this._currentState===BlockState.clickable&&(this._clickCount++,1===this._clickCount?(-1!==t.indexOf("rush")?this._clickableRushColor=RES.getRes(BlockTexture.clickableNormalRushStyle):this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._draw()):2===this._clickCount&&this._hit())},t}(BlockBase);__reflect(BlockDouble.prototype,"BlockDouble");var MagicPurify=function(e){function t(){var t=e.call(this)||this;return t.setQty(Service.MAGIC_CONFIG.purify.qty),t}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("purify_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:3,offsetY:this.icon.height*this._zoomRate-30}},t.prototype.disable=function(){e.prototype.disable.call(this),this.icon.texture=RES.getRes("purify_disabled_png")},t.prototype.enable=function(){e.prototype.enable.call(this),this.icon.texture=RES.getRes("purify_png")},t}(MagicBase);__reflect(MagicPurify.prototype,"MagicPurify");var MagicQuell=function(e){function t(){var t=e.call(this)||this;return t.setQty(Service.MAGIC_CONFIG.quell.qty),t}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("skull_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:3,offsetY:this.icon.height*this._zoomRate-30}},t.prototype.disable=function(){e.prototype.disable.call(this),this.icon.texture=RES.getRes("skull_disabled_png")},t.prototype.enable=function(){e.prototype.enable.call(this),this.icon.texture=RES.getRes("skull_png")},t}(MagicBase);__reflect(MagicQuell.prototype,"MagicQuell");var Timer=egret.Timer,Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)}),this.tokenTimer=new egret.Timer(6e4,0),this.tokenTimer.addEventListener(egret.TimerEvent.TIMER,this.localCheck,this),this.tokenTimer.start(),this.localCheck()},t.prototype.localCheck=function(){var e=egret.localStorage.getItem(Constant.G_TOKEN_KEY),t=egret.localStorage.getItem(Constant.G_TOKEN_EXPIRE_KEY),i=this;if(""==e||""==t||Number(t)<WxgUtils.getNowTimestamp()+300){var n=new egret.HttpRequest,r=function(e){switch(e.type){case egret.Event.COMPLETE:var t=e.currentTarget,i=JSON.parse(t.response);0==i.status?(egret.localStorage.setItem(Constant.G_TOKEN_KEY,i.token),egret.localStorage.setItem(Constant.G_TOKEN_EXPIRE_KEY,i.expire)):console.log("gettoken err =>"+i.reason+","+i.status);break;case egret.IOErrorEvent.IO_ERROR:}},s=Constant.getGettokenUrl();egret.ExternalInterface.call("showtest",s),n.once(egret.Event.COMPLETE,r,i),n.once(egret.IOErrorEvent.IO_ERROR,r,i);var o=egret.localStorage.getItem(Constant.G_OPENID_KEY),a=egret.localStorage.getItem(Constant.G_UNAME_KEY);Constant.isdebug&&(""==o||null==o||null==a||""==a)&&(console.log("调用调试openid"),o="o7Vp401Z9LZaQoBfO1Zq_wfN7QSk",egret.localStorage.setItem(Constant.G_UNAME_KEY,"g1561620209406139")),s=s+"&openid="+o,n.open(s,egret.HttpMethod.GET),n.send()}},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),[4,this.createGameScene()];case 2:return e.sent(),Toast.init(this,RES.getRes("toast-bg_png")),this._attachEvents(),[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this._gameService=new Service(e),[4,this._gameService.getGameConfig()];case 4:return t=n.sent(),this.stage.removeChild(e),[3,6];case 5:return i=n.sent(),console.error(i),[3,6];case 6:return[2]}})})},t.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.setNativeListener(),this.checkLogin(),[2]})})},t.prototype.checkLogin=function(){var e=egret.localStorage.getItem(Constant.G_UID_KEY);null==e||""==e?this.login():this.index()},t.prototype.index=function(){this.removeChildren();var e=new Indexcon;this.addChild(e);var t=new Usertop;this.addChild(t),e.addEventListener(GameEvent.GAME_START,this.startgame,this),e.addEventListener(GameEvent.GAME_RANK,this.rank,this),e.addEventListener(GameEvent.GAME_MESSAGE,this.message,this),e.addEventListener(GameEvent.GAME_FRIEND,this.friend,this),e.addEventListener(GameEvent.GAME_SETTING,this.setting,this),t.addEventListener(GameEvent.GAME_SHOPSKILL,this.skillshop,this),this._testBtn()},t.prototype.setting=function(){this.removeChildren();var e=new Setting;e.addEventListener(GameEvent.GAME_INDEX,this.index,this),this.addChild(e)},t.prototype.friend=function(){this.removeChildren();var e=new Friend;this.addChild(e),e.addEventListener(GameEvent.GAME_INDEX,this.index,this),e.addEventListener(GameEvent.GAME_SEARCHFRIEND,this.searchuser,this)},t.prototype.searchuser=function(){this.removeChildren();var e=egret.localStorage.getItem(Constant.G_SEARCHUSER_KEY),t=new SearchFriend(e);this.addChild(t),t.addEventListener(GameEvent.GAME_FRIEND,this.friend,this)},t.prototype.login=function(){this.removeChildren();var e=new Login;this.addChild(e)},t.prototype.message=function(){this.removeChildren();var e=new Message;this.addChild(e),e.addEventListener(GameEvent.GAME_INDEX,this.index,this)},t.prototype.rank=function(){this.removeChildren();var e=new Rank;this.addChild(e),e.addEventListener(GameEvent.GAME_INDEX,this.index,this)},t.prototype.skillshop=function(){this.removeChildren();var e=new Shopskill;this.addChild(e),e.addEventListener(GameEvent.GAME_INDEX,this.index,this)},t.prototype.setNativeListener=function(){var e=this;egret.ExternalInterface.addCallback("getcode",function(e){""!=e&&window.alert(e)}),egret.ExternalInterface.addCallback("wxloginR",function(t){if(""!=t){var i=new egret.HttpRequest,n=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget,n=JSON.parse(i.response);if(0==n.status){egret.localStorage.setItem(Constant.G_UID_KEY,n.data.uid),egret.localStorage.setItem(Constant.G_NICKNAME_KEY,n.data.truename);var r=String((Constant.G_USEREXPIRETIME_KEY,Date.parse((new Date).toString())/1e3));egret.localStorage.setItem(Constant.G_USEREXPIRETIME_KEY,r),egret.localStorage.setItem(Constant.G_UNAME_KEY,n.data.username),e.index()}else window.alert(n.reason);break;case egret.IOErrorEvent.IO_ERROR:}};i.once(egret.Event.COMPLETE,n,e),i.once(egret.IOErrorEvent.IO_ERROR,n,e);var r=Constant.getLoginUrl(),s=JSON.parse(t);egret.localStorage.setItem(Constant.G_OPENID_KEY,s.openid),r=r+"&c="+encodeURIComponent(t)+"&type=weixin&openid="+s.openid+"&unionid="+s.unionid,i.open(r,egret.HttpMethod.GET),i.send()}}),egret.ExternalInterface.addCallback("googleloginR",function(e){console.log("message from Native google login is = "+e)})},t.prototype.startgame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,n,r,s,o;return __generator(this,function(a){switch(a.label){case 0:return this.removeChildren(),[4,this._gameService.getMyProlist()];case 1:return e=a.sent(),this._GameScreen=new GameScreen,this.addChild(this._GameScreen),t=Utils.getStageWidth()/2,console.log(Utils.getStageWidth()),i=80,n=new UIComponents.DefaultButton(t,i,"Start"),n.x=Utils.getStageWidth()/2-t/2,n.y=.3*Utils.getStageHeight(),n.addEventListener("touchTap",this._startGame,this),this._startButton=n,this.addChild(n),r=Utils.getStageWidth()/2,s=80,o=new UIComponents.DefaultButton(r,s,"Game over"),o.x=Utils.getStageWidth()/2-r/2,o.y=.3*Utils.getStageHeight(),o.visible=!1,o.addEventListener("touchTap",this._restartGame,this),this._gameOverButton=o,this.addChild(o),[2]}})})},t.prototype._startGame=function(){this._startButton.visible=!1,this._GameScreen.gameScene.gameStart()},t.prototype._testBtn=function(){console.log("点击了测试按钮哦..................我哈哈");var e=WxgUtils.getYmd((new Date).getTime()),t=egret.localStorage.getItem(Constant.G_FIRST_LOOKDATE);if(null==t||""==t||t!=e){egret.localStorage.setItem(Constant.G_FIRST_LOOKDATE,e);var i=new TaskUI;i.x=0,i.y=0,this.addChild(i)}},t.prototype._restartGame=function(){this._startButton.visible=!0,this._gameOverButton.visible=!1,this._GameScreen.reset()},t.prototype._attachEvents=function(){this.addEventListener(GameEvents.PlayEvent.GAME_OVER,this._gameOver,this)},t.prototype._gameOver=function(e){this._gameOverButton.visible=!0},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,n=e.map(function(e){return i.parse(e)
}),r=this.textfield,s=-1,o=function(){s++,s>=n.length&&(s=0);var e=n[s];r.textFlow=e;var i=egret.Tween.get(r);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(o,t)};o()},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Message=function(e){function t(){var t=e.call(this)||this;return t.type=1,t.msg_Const="信息",t.friend_Const="朋友",t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.rightLabel.touchEnabled=!0,this.rightLabel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLabelForRight,this),this.back.touchEnabled=!0,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gotoIndex,this),this.datalist.scrollEnabled=!0,this.loadList("1,2,3,4")},t.prototype.gotoIndex=function(){var e=new GameEvent(GameEvent.GAME_INDEX);this.dispatchEvent(e)},t.prototype.loadData=function(){},t.prototype.changeLabelForRight=function(){var e=this.rightLabel.text,t="";e==this.msg_Const?(this.type=1,this.rightLabel.text=this.friend_Const,this.msgBtn.text=this.msg_Const,t="1,2,3,4"):(this.type=2,this.msgBtn.text=this.friend_Const,this.rightLabel.text=this.msg_Const,t="0"),this.loadList(t)},t.prototype.backToIndex=function(){console.log("backToIndex........");var e=new GameEvent(GameEvent.GAME_INDEX);this.dispatchEvent(e)},t.prototype.switchText=function(e){},t.prototype.getMsgTypeImgPath=function(e){var t="";return"1"==e?t="msgtype_sys_png":"2"==e?t="msgtype_sys_png":"3"==e?t="msgtype_act_png":"4"==e?t="msg_service_png":"0"==e&&(t="msgtype_sys_png"),t},t.prototype.getMsgTypeText=function(e){var t="";return"1"==e?t="系统消息":"2"==e?t="公告":"3"==e?t="奖品公告":"4"==e?t="服务公告":"0"==e&&(t="私信"),t},t.prototype.loadList=function(e){var t=this,i=new egret.HttpRequest,n=function(e){switch(e.type){case egret.Event.COMPLETE:var i=e.currentTarget;console.log(i.response);var n=JSON.parse(i.response);if(0==n.status){t.dataScroll.removeChildren(),t.datalist=new eui.List,t.datalist.width=1080,t.datalist.height=1506,t.dataScroll.addChild(t.datalist);var r=Number(n.count);if(r>0){for(var s=0;r>s;s++){var o=n.rows[s].msgtype;n.rows[s].content,n.rows[s].addtime;n.rows[s].title=t.getMsgTypeText(o),n.rows[s].typeimg=t.getMsgTypeImgPath(o)}t.datalist.dataProvider=new eui.ArrayCollection(n.rows),t.datalist.itemRenderer=MsgListIRSkin}}else console.log("loadList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};i.once(egret.Event.COMPLETE,n,t),i.once(egret.IOErrorEvent.IO_ERROR,n,t);var r=Constant.getMsglistUrl();r=r+"&"+WxgUtils.getTokenParam()+"&types="+e,console.log("#"+r),i.open(r,egret.HttpMethod.GET),i.send()},t}(eui.Component);__reflect(Message.prototype,"Message",["eui.UIComponent","egret.DisplayObject"]);var MsgListIRSkin=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/Msgitem.exml",t}return __extends(t,e),t}(eui.ItemRenderer);__reflect(MsgListIRSkin.prototype,"MsgListIRSkin");var Msgitem=function(e){function t(t,i,n,r){var s=e.call(this)||this;return s.typeImgRes=t,s.typeTextVal=i,s.datetimeVal=n,s.textVal=r,s.addEventListener(eui.UIEvent.CREATION_COMPLETE,s.initEui,s),s}return __extends(t,e),t.prototype.initEui=function(){this.typeImg.texture=RES.getRes(this.typeImgRes),this.typeText.text=this.typeTextVal,this.datetime.text=this.datetimeVal,this.text.text=this.textVal},t}(eui.Component);__reflect(Msgitem.prototype,"Msgitem",["eui.UIComponent","egret.DisplayObject"]);var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Rank=function(e){function t(){var t=e.call(this)||this;return t.Const_todayRank="日榜",t.Const_weekRank="周榜",t.Const_singleRank="单局榜",t.showType=1,t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.label_bottom.touchEnabled=!0,this.label_bottom.text=this.Const_todayRank,this.label_left.touchEnabled=!0,this.label_left.text=this.Const_weekRank,this.label_left.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLabelForLeft,this),this.label_right.touchEnabled=!0,this.label_right.text=this.Const_singleRank,this.label_right.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeLabelForRight,this),this.back.touchEnabled=!0,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToIndex,this),this.loadRank()},t.prototype.backToIndex=function(){console.log("backToIndex........");var e=new GameEvent(GameEvent.GAME_INDEX);this.dispatchEvent(e)},t.prototype.switchText=function(e){e==this.Const_todayRank?(this.showType=1,this.label_bottom.text=this.Const_todayRank,this.label_left.text=this.Const_weekRank,this.label_right.text=this.Const_singleRank):e==this.Const_singleRank?(this.showType=3,this.label_bottom.text=this.Const_singleRank,this.label_left.text=this.Const_weekRank,this.label_right.text=this.Const_todayRank):e==this.Const_weekRank&&(this.showType=2,this.label_bottom.text=this.Const_weekRank,this.label_left.text=this.Const_singleRank,this.label_right.text=this.Const_todayRank),this.loadRank()},t.prototype.changeLabelForBottom=function(){},t.prototype.changeLabelForLeft=function(){var e=this.label_left.text;console.log("changeLabelForLeft....."+e),this.switchText(e)},t.prototype.changeLabelForRight=function(){var e=this.label_right.text;console.log("changeLabelForRight....."+e),this.switchText(e)},t.prototype.loadRank=function(){this.contentScroller.removeChildren(),1==this.showType?this.loadScoreList():2==this.showType||this.loadSingleScoreList()},t.prototype.getRankPicRes=function(e){var t="";return t=1==e?"rank_no1_png":2==e?"rank_no2_png":3==e?"rank_no3_png":"rank_pic_png"},t.prototype.loadScoreList=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget;console.log(i.response);var n=JSON.parse(i.response);if(0==n.status){var r=n.myscore,s=n.myrank,o="rank_blue_png",a=new Ranklistitem(n.avater,egret.localStorage.getItem(Constant.G_NICKNAME_KEY),r,e.getRankPicRes(Number(s)),s,o);e.contentScroller.addChild(a);var c=Number(n.count);if(c>0)for(var l="",h=0;c>h;h++){var u=n.rows[h].rscore,_=(n.rows[h].uid,n.rows[h].nick),g=n.rows[h].photo;l=0==h?"rank_yellow_png":1==h?"rank_orange_png":2==h?"rank_red_png":"rank_green_png";var a=new Ranklistitem(g,_,u,e.getRankPicRes(h+1),String(h+1),l);a.y=130*(h+1),e.contentScroller.addChild(a)}}else console.log("loadScoreList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getRanklistUrl();n=n+"&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.loadWeekScoreList=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget;console.log(i.response);var n=JSON.parse(i.response);if(0==n.status){var r=n.myscore,s=n.myrank,o="rank_blue_png",a=new Ranklistitem(n.avater,egret.localStorage.getItem(Constant.G_NICKNAME_KEY),r,e.getRankPicRes(Number(s)),s,o);e.contentScroller.addChild(a);var c=Number(n.count);if(c>0)for(var l="",h=0;c>h;h++){var u=n.rows[h].rscore,_=(n.rows[h].uid,n.rows[h].nick),g=n.rows[h].photo;l=0==h?"rank_yellow_png":1==h?"rank_orange_png":2==h?"rank_red_png":"rank_green_png";var a=new Ranklistitem(g,_,u,e.getRankPicRes(h+1),String(h+1),l);a.y=130*(h+1),e.contentScroller.addChild(a)}}else console.log("loadScoreList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getWeekRanklistUrl();n=n+"&"+WxgUtils.getTokenParam(),console.log("single#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.loadSingleScoreList=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget;console.log(i.response);var n=JSON.parse(i.response);if(0==n.status){var r=n.myscore,s=n.myrank,o="rank_blue_png",a=new Ranklistitem(n.avater,egret.localStorage.getItem(Constant.G_NICKNAME_KEY),r,e.getRankPicRes(Number(s)),s,o);e.contentScroller.addChild(a);var c=Number(n.count);if(c>0)for(var l="",h=0;c>h;h++){var u=n.rows[h].rscore,_=(n.rows[h].uid,n.rows[h].nick),g=n.rows[h].photo;l=0==h?"rank_yellow_png":1==h?"rank_orange_png":2==h?"rank_red_png":"rank_green_png";var a=new Ranklistitem(g,_,u,e.getRankPicRes(h+1),String(h+1),l);a.y=130*(h+1),e.contentScroller.addChild(a)}}else console.log("loadScoreList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getSingleRanklistUrl();n=n+"&"+WxgUtils.getTokenParam(),console.log("single#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.playgameBtnCallback=function(e){if(e.type==egret.TouchEvent.TOUCH_BEGIN)e.currentTarget.scaleX=1.05,e.currentTarget.scaleY=1.05;else if(e.type==egret.TouchEvent.TOUCH_END){e.currentTarget.scaleX=1,e.currentTarget.scaleY=1;var t=new GameEvent(GameEvent.GAME_START);this.dispatchEvent(t)}else e.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE&&(e.currentTarget.scaleX=1,e.currentTarget.scaleY=1)},t}(eui.Component);__reflect(Rank.prototype,"Rank",["eui.UIComponent","egret.DisplayObject"]);var Ranklistitem=function(e){function t(t,i,n,r,s,o){var a=e.call(this)||this;return a.avaterUrl=t,a.nickStr=i,a.scoreStr=n,a.picRes=r,a.numStr=s,a.bgRes=o,a.addEventListener(eui.UIEvent.CREATION_COMPLETE,a.initEui,a),a}return __extends(t,e),t.prototype.initEui=function(){this.nicktext.text=this.nickStr,this.scoretext.text=this.scoreStr,this.rank_pic.texture=RES.getRes(this.picRes),this.rank_num.text=this.numStr,this.bg.texture=RES.getRes(this.bgRes),this.loadAvater(this.avaterUrl)},t.prototype.loadAvater=function(e){var t=this,i=new egret.ImageLoader;i.crossOrigin="anonymous",i.load(e),i.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){var i=new egret.Texture;i.bitmapData=e.currentTarget.data,t.avater.texture=i}},this)},t}(eui.Component);__reflect(Ranklistitem.prototype,"Ranklistitem",["eui.UIComponent","egret.DisplayObject"]);var Score=function(e){function t(){var t=e.call(this)||this;t._scorePrefix="Score: ",t._score=0,t.BlockNormalNumber=0,t.BlockDoubleNumber=0,t.BlockRushNumber=0,t.BlockShrinkNumber=0,t.BlockBlinkNumber=0;var i=45,n=70,r=Utils.createBitmapByName("bg_score_png");r.height=n,r.width=.7*Utils.getStageWidth(),r.x=(Utils.getStageWidth()-r.width)/2,r.y=i,t.addChild(r);var s=new egret.TextField;return s.fontFamily="Ngaan",s.width=Utils.getStageWidth(),s.y=i,s.height=n,s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE,s.textColor=16777215,s.strokeColor=16773376,s.size=36,s.textFlow=[{text:t._scorePrefix,style:{size:36}},{text:t._score.toString(),style:{textColor:16773376}}],t._scoreText=s,t.addChild(t._scoreText),t}return __extends(t,e),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e,this._scoreText.textFlow=[{text:this._scorePrefix,style:{size:36}},{text:this._score.toString(),style:{textColor:16773376}}]},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._score=0,this.BlockNormalNumber=0,this.BlockDoubleNumber=0,this.BlockRushNumber=0,this.BlockShrinkNumber=0,this.BlockBlinkNumber=0},t}(egret.Sprite);__reflect(Score.prototype,"Score");var SearchFriend=function(e){function t(t){var i=e.call(this)||this;return i.searchKeyStr=t,i.addEventListener(eui.UIEvent.CREATION_COMPLETE,i.initEui,i),i}return __extends(t,e),t.prototype.initEui=function(){null!=this.searchKeyStr&&""!=this.searchKeyStr&&this.loadSearchList(),this.back.touchEnabled=!0,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToBef,this),this.friendSearch.touchEnabled=!0,this.friendSearch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.searchUser,this)},t.prototype.searchUser=function(){var e=this.searchUserkey.text;null!=e&&""!=e&&(this.searchKeyStr=e,this.loadSearchList())},t.prototype.backToBef=function(){console.log("backToBef.........");var e=new GameEvent(GameEvent.GAME_FRIEND);this.dispatchEvent(e)},t.prototype.loadSearchList=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget;console.log(i.response);var n=JSON.parse(i.response);if(0==n.status){var r=Number(n.count);r>0&&(e.datascroll.removeChildren(),e.datalist=new eui.List,e.datalist.width=1080,e.datalist.height=1613,e.datascroll.addChild(e.datalist),e.datalist.dataProvider=new eui.ArrayCollection(n.rows),e.datalist.itemRenderer=SearchFriendListIRSkin)}else console.log("loadList err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.searchUserUrl();n=n+"&"+WxgUtils.getTokenParam()+"&nick="+e.searchKeyStr,console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t}(eui.Component);__reflect(SearchFriend.prototype,"SearchFriend",["eui.UIComponent","egret.DisplayObject"]);var SearchFriendListIRSkin=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/skins/SearchFrienditem.exml",t}return __extends(t,e),t.prototype.dataChanged=function(){var e=this,t=new egret.ImageLoader;t.crossOrigin="anonymous",t.load(this.data.avater),t.once(egret.Event.COMPLETE,function(t){if(t.currentTarget.data){var i=new egret.Texture;i.bitmapData=t.currentTarget.data,e.avater.source=i}},this),this.addfriend.touchEnabled=!0,this.addfriend.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addFriend,this)},t.prototype.addFriend=function(){var e=this.data.uid,t=this,i=new egret.HttpRequest,n=function(e){switch(e.type){case egret.Event.COMPLETE:var i=e.currentTarget;console.log(i.response);var n=JSON.parse(i.response);0==n.status?(t.addfriend.visible=!1,Toast.launch("添加好友成功")):(Toast.launch("添加好友失败| err =>"+n.reason+","+n.status),console.log("addFriendUrl err =>"+n.reason+","+n.status));break;case egret.IOErrorEvent.IO_ERROR:}};i.once(egret.Event.COMPLETE,n,t),i.once(egret.IOErrorEvent.IO_ERROR,n,t);var r=Constant.addFriendUrl();r=r+"&"+WxgUtils.getTokenParam()+"&touid="+e,console.log("#"+r),i.open(r,egret.HttpMethod.GET),i.send()},t}(eui.ItemRenderer);__reflect(SearchFriendListIRSkin.prototype,"SearchFriendListIRSkin");var Service=function(){function e(e){this._configrations=[{url:"index.php?m=game&f=index&v=public_load_dtwconfig",name:"gameConfig"}],this._loaded=0,this._loadingView=e}return e.prototype.getGameConfig=function(){var t=this;return new Promise(function(i){for(var n=function(n){t._loadingView.onRemoteProgress(n+1,t._configrations.length);var r=t._configrations[n];if(null==e.GAME_CONFIG||"gameConfig"!==r.name){var s=new egret.HttpRequest,o=function(t){switch(t.type){case egret.Event.COMPLETE:var n=t.currentTarget,s=JSON.parse(n.response);"gameConfig"===r.name&&(e.GAME_CONFIG=s),i(s);break;case egret.IOErrorEvent.IO_ERROR:i({message:"IO ERROR in"+r.name})}};s.once(egret.Event.COMPLETE,o,t),s.once(egret.IOErrorEvent.IO_ERROR,o,t),s.open(e.baseURL+r.url,egret.HttpMethod.GET),s.send()}else i(e.GAME_CONFIG)},r=0;r<t._configrations.length;r++)n(r)})},e.gameStart=function(){var t=new egret.HttpRequest,i=function(e){switch(e.type){case egret.Event.COMPLETE:var t=e.currentTarget,i=JSON.parse(t.response);i.status&&"0"===i.status?console.info("Service:GameStarted:Success"):console.error("Service:GameStarted:Error"+i.reason);break;case egret.IOErrorEvent.IO_ERROR:console.error("Service:GameStarted:Error")}};t.once(egret.Event.COMPLETE,i,this),t.once(egret.IOErrorEvent.IO_ERROR,i,this),t.open(e.gameStartURL+"&"+WxgUtils.getTokenParam(),egret.HttpMethod.GET),t.send()},e.gameScore=function(t){var i=new egret.HttpRequest,n=function(e){switch(e.type){case egret.Event.COMPLETE:var t=e.currentTarget,i=JSON.parse(t.response);i.status&&"0"===i.status?console.info("Service:GameScore:Success"):console.error("Service:GameScore:Error"+i.reason);break;case egret.IOErrorEvent.IO_ERROR:console.error("Service:GameScore:Error")}},r={black_block:t.score.BlockNormalNumber,blue_block:t.score.BlockDoubleNumber,red_block:t.score.BlockRushNumber,yellow_block:t.score.BlockBlinkNumber,purple_block:t.score.BlockShrinkNumber};i.once(egret.Event.COMPLETE,n,this),i.once(egret.IOErrorEvent.IO_ERROR,n,this),i.open(e.gameScoreURL+"&"+WxgUtils.getTokenParam()+"&level="+t.level+"&score="+t.score.score+"&gdata="+JSON.stringify(r),egret.HttpMethod.GET),i.send()},e.useMagic=function(t){var i=this;return new Promise(function(n){var r=new egret.HttpRequest,s=function(e){switch(e.type){case egret.Event.COMPLETE:var t=e.currentTarget,i=JSON.parse(t.response);if(console.log(i),i.status&&"0"===i.status){var r=JSON.parse(i.data);n(r.num),console.info("Service:UseMagic:Success")}else console.error("Service:UseMagic:Error"+i.reason);break;case egret.IOErrorEvent.IO_ERROR:console.error("Service:UseMagic:Error")}};r.once(egret.Event.COMPLETE,s,i),r.once(egret.IOErrorEvent.IO_ERROR,s,i),r.open(e.gameUseMagicURL+"&"+WxgUtils.getTokenParam()+"&m2gid="+t.id,egret.HttpMethod.GET),r.send()})},e.prototype.getMyProlist=function(){var t=this;return new Promise(function(i){var n=new egret.HttpRequest,r=function(t){switch(t.type){case egret.Event.COMPLETE:var n=t.currentTarget,r=JSON.parse(n.response),s={freeze:{qty:0,id:""},purify:{qty:0,id:""},destroy:{qty:0,id:""},quell:{qty:0,id:""}};if(0==r.status){for(var o=0;o<r.rows.length;o++){var a=parseInt(r.rows[o].num,10),c=r.rows[o].id,l=r.rows[o].opertype;"speed"==l?(s.freeze.qty=a,s.freeze.id=c):"clear"==l?(s.purify.qty=a,s.purify.id=c):"lock"==l?(s.quell.qty=a,s.quell.id=c):"stillclear"==l&&(s.destroy.qty=a,s.destroy.id=c)}e.MAGIC_CONFIG=s,i(s)}else console.log("err =>"+r.reason+","+r.status);break;case egret.IOErrorEvent.IO_ERROR:}};n.once(egret.Event.COMPLETE,r,t),n.once(egret.IOErrorEvent.IO_ERROR,r,t);var s=Constant.getMyProlist();s=s+"&"+WxgUtils.getTokenParam(),console.log("#"+s),n.open(s,egret.HttpMethod.GET),n.send()})},e.baseURL="https://game.weiplus5.com/",e.gameStartURL=e.baseURL+"index.php?m=game&v=startgame",e.gameScoreURL=e.baseURL+"index.php?m=game&v=addGameScore",e.gameUseMagicURL=e.baseURL+"index.php?m=game&v=useGameProp",e}();__reflect(Service.prototype,"Service");var Setting=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.musicState.addEventListener(eui.UIEvent.CHANGE,this.musicSwitchChangeCallback,this),this.musicSlider.addEventListener(egret.Event.CHANGE,this.musicSliderChangeCallback,this),this.saveBtn.touchEnabled=!0,this.saveBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.saveSetting,this),this.back.touchEnabled=!0,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToIndex,this),this.initData(),this.avater.mask=this.avamask},t.prototype.backToIndex=function(){var e=new GameEvent(GameEvent.GAME_INDEX);this.dispatchEvent(e)},t.prototype.initData=function(){this.loadLocalInfo(),this.loadUserInfo()},t.prototype.saveSetting=function(){var e=this.nationinput.text,t=this.mobileinput.text,i=this.receiveinput.text,n=this,r=new egret.HttpRequest,s=function(e){switch(e.type){case egret.Event.COMPLETE:var t=e.currentTarget,i=JSON.parse(t.response);0==i.status?Toast.launch("保存成功"):(Toast.launch("保存失败 | "+Constant.getErrorDesc(i.status)),console.log("getuserinfo err =>"+i.reason+","+i.status));break;case egret.IOErrorEvent.IO_ERROR:}};r.once(egret.Event.COMPLETE,s,n),r.once(egret.IOErrorEvent.IO_ERROR,s,n);var o=Constant.getUpinfoUrl();o=o+"&country="+e+"&receive_addr="+i+"&mobile="+t+"&"+WxgUtils.getTokenParam(),console.log("#"+o),r.open(o,egret.HttpMethod.GET),r.send()},t.prototype.musicSwitchChangeCallback=function(e){var t=e.target,i="";i=t.selected?"1":"0",egret.localStorage.setItem(Constant.G_MUSIC_STATE_KEY,i)},t.prototype.musicSliderChangeCallback=function(){var e=this.musicSlider.value;egret.localStorage.setItem(Constant.G_MUSIC_VAL_KEY,String(e))},t.prototype.loadLocalInfo=function(){var e=egret.localStorage.getItem(Constant.G_MUSIC_VAL_KEY);(null==e||""==e)&&(e=String(Constant.G_MUSIC_DEFAULTVAL)),this.musicSlider.value=Number(e);var t=egret.localStorage.getItem(Constant.G_MUSIC_STATE_KEY);(null==t||""==t)&&(t="1"),"1"==t?this.musicState.selected=!0:this.musicState.selected=!1},t.prototype.loadUserInfo=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget,n=JSON.parse(i.response);if(0==n.status){var r=n.data.thumb;null!=r&&""!=r&&e.loadAvater(r);var s=n.data.country;e.nationinput.text=s;var o=n.data.receive_addr;e.receiveinput.text=o;var a=n.data.mobile;e.mobileinput.text=a}else console.log("getuserinfo err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getUserinfoUrl();n=n+"&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.loadAvater=function(e){var t=this,i=new egret.ImageLoader;i.crossOrigin="anonymous",i.load(e),i.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){var i=new egret.Texture;i.bitmapData=e.currentTarget.data,t.avater.texture=i}},this)},t}(eui.Component);__reflect(Setting.prototype,"Setting",["eui.UIComponent","egret.DisplayObject"]);var Shop=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){},t}(eui.Component);__reflect(Shop.prototype,"Shop",["eui.UIComponent","egret.DisplayObject"]);var Shopskill=function(e){function t(){var t=e.call(this)||this;return t.data_buynum=1,t.defaultType="speed",t.data_propprice=0,t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.buybtn.touchEnabled=!0,this.buybtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.buyskill,this),this.minusBtn.touchEnabled=!0,this.minusBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.minusNum,this),this.plusBtn.touchEnabled=!0,this.plusBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.plusNum,this),this.freezeselect.visible=!1,this.reviveselect.visible=!1,this.purifyselect.visible=!1,this.skullselect.visible=!1,this.nukeselect.visible=!1,this.back.touchEnabled=!0,this.back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToIndex,this),this.skullbtn.touchEnabled=!0,this.skullbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setSkullType,this),this.freezebtn.touchEnabled=!0,this.freezebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setFreezeType,this),this.purifybtn.touchEnabled=!0,this.purifybtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setPurifyType,this),this.nukebtn.touchEnabled=!0,this.nukebtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setNukeType,this),this.initData()},t.prototype.backToIndex=function(){var e=new GameEvent(GameEvent.GAME_INDEX);this.dispatchEvent(e)},t.prototype.loadDefaultType=function(){var e=this.skillJsonData;if(0==e.status){var t=(e.count,e.rows.speed0);t.length>0&&this.setPageData(t[0])}},t.prototype.setSkullType=function(){var e=this.skillJsonData;if(0==e.status){var t=(e.count,e.rows.lock0);t.length>0&&this.setPageData(t[0])}},t.prototype.setFreezeType=function(){var e=this.skillJsonData;if(0==e.status){var t=(e.count,e.rows.speed0);t.length>0&&this.setPageData(t[0])}},t.prototype.setPurifyType=function(){var e=this.skillJsonData;if(0==e.status){var t=(e.count,e.rows.clear0);t.length>0&&this.setPageData(t[0])}},t.prototype.setNukeType=function(){var e=this.skillJsonData;if(0==e.status){var t=(e.count,e.rows.stillclear0);t.length>0&&this.setPageData(t[0])}},t.prototype.removeEffect=function(e){"speed"==e?null!=this.freeMc&&(this.removeChild(this.freeMc),this.freeMc=null):"clear"==e?null!=this.jingshiMc&&(this.removeChild(this.jingshiMc),this.jingshiMc=null):"lock"==e?null!=this.zhenyaMc&&(this.removeChild(this.zhenyaMc),this.zhenyaMc=null):"stillclear"==e&&null!=this.yanmieMc&&(this.removeChild(this.yanmieMc),this.yanmieMc=null)},t.prototype.playDescEffect=function(e){this.removeEffect("speed"),this.removeEffect("clear"),this.removeEffect("lock"),this.removeEffect("stillclear");var t=220,i=250;if("speed"==e)null==this.freeMc&&(this.freeMc=new eui.Image,this.freeMc.texture=RES.getRes("freeze_desc_png"),this.freeMc.x=t,this.freeMc.y=i,this.addChild(this.freeMc));else if("clear"==e){if(null==this.jingshiMc){var n=RES.getRes("jingshi_json"),r=RES.getRes("jingshi_png"),s=new egret.MovieClipDataFactory(n,r);this.jingshiMc=new egret.MovieClip(s.generateMovieClipData("jingshi")),this.jingshiMc.x=t,this.jingshiMc.y=i,this.addChild(this.jingshiMc),this.jingshiMc.gotoAndPlay("startjingshi",-1)}}else if("lock"==e){if(null==this.zhenyaMc){var n=RES.getRes("zhenya_json"),r=RES.getRes("zhenya_png"),s=new egret.MovieClipDataFactory(n,r);this.zhenyaMc=new egret.MovieClip(s.generateMovieClipData("zhenya")),this.zhenyaMc.x=t,this.zhenyaMc.y=i,this.addChild(this.zhenyaMc),this.zhenyaMc.gotoAndPlay("start",-1)}}else if("stillclear"==e&&null==this.yanmieMc){var n=RES.getRes("yanmie_json"),r=RES.getRes("yanmie_png"),s=new egret.MovieClipDataFactory(n,r);this.yanmieMc=new egret.MovieClip(s.generateMovieClipData("yanmie")),this.yanmieMc.x=t,this.yanmieMc.y=i,this.addChild(this.yanmieMc),this.yanmieMc.gotoAndPlay("start",-1)}},t.prototype.setPageData=function(e){this.freezeselect.visible=!1,this.purifyselect.visible=!1,this.skullselect.visible=!1,this.nukeselect.visible=!1,this.skillprice.text=String(Number(e.discount_price)),this.mymoney.text=String(this.data_mymoney),this.data_propprice=Number(e.discount_price),this.skillname.text=e.name+":",this.skilldesc.text=e.descrip;var t=e.opertype;this.data_nowtype=t,this.data_buyproid=e.id,"speed"==t?this.freezeselect.visible=!0:"clear"==t?this.purifyselect.visible=!0:"lock"==t?this.skullselect.visible=!0:"stillclear"==t&&(this.nukeselect.visible=!0),this.playDescEffect(t)},t.prototype.minusNum=function(){var e=Number(this.buynum.text);e>0&&e--,this.buynum.text=String(e)},t.prototype.plusNum=function(){var e=Number(this.buynum.text);e++,this.buynum.text=String(e)},t.prototype.buyskill=function(){var e="";if(this.data_buyproid>0)if(this.data_buynum=Number(this.buynum.text),this.data_buynum>0){if(this.data_propprice>0&&this.data_mymoney<this.data_propprice*this.data_buynum)return void Toast.launch("金豆不足");var t=this,i=new egret.HttpRequest,n=function(e){switch(e.type){case egret.Event.COMPLETE:var i=e.currentTarget,n=JSON.parse(i.response),r="";0==n.status?(r="购买成功",t.initData()):(r="购买失败,"+n.status+","+n.reason,console.log("err =>"+n.reason+","+n.status)),Toast.launch(r);break;case egret.IOErrorEvent.IO_ERROR:}};i.once(egret.Event.COMPLETE,n,t),i.once(egret.IOErrorEvent.IO_ERROR,n,t);var r=Constant.getBuyPropUrl();r=r+"&num="+this.data_buynum+"&propid="+this.data_buyproid+"&"+WxgUtils.getTokenParam(),console.log("#"+r),i.open(r,egret.HttpMethod.GET),i.send()}else e="购买个数必须大于0";else e="请选择要购买的技能";""!=e&&Toast.launch(e)},t.prototype.initData=function(){this.buynum.text="1",this.getProList(),this.getMyProlist()},t.prototype.getProList=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget,n=JSON.parse(i.response);if(0==n.status){var r=Number(String(n.money));e.data_mymoney=r,e.skillJsonData=n,e.loadDefaultType()}else console.log("err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getPropListUrl();n=n+"&isskill=yes&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.getMyProlist=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget,n=JSON.parse(i.response);if(console.log(i.response),0==n.status)for(var r=0;r<n.rows.length;r++){var s=n.rows[r].num,o=n.rows[r].opertype;"speed"==o?e.freezenum.text=s:"clear"==o?e.purifynum.text=s:"lock"==o?e.skullnum.text=s:"stillclear"==o&&(e.nukenum.text=s)}else console.log("err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getMyProlist();n=n+"&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t}(eui.Component);__reflect(Shopskill.prototype,"Shopskill",["eui.UIComponent","egret.DisplayObject"]);var TaskUI=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t}return __extends(t,e),t.prototype.uiCompHandler=function(){console.log("		AboutUI uiCompHandler");var e=this;this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("点击了关闭按钮........."),e.parent.removeChild(e)},this)},t}(eui.Component);__reflect(TaskUI.prototype,"TaskUI",["eui.UIComponent","egret.DisplayObject"]);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function r(e){t.call(n,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(n,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var c=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(n,generateJSON.paths[e])},this):RES.getResByUrl(c,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(n,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Time;!function(e){var t=function(){function e(e,t){this._time=0,this._interval=1,this._times=e.times,this._timesRemains=e.times,this._callbackFinish=e.finish,this._scope=t,e.interval&&(this._interval=e.interval),e.tick&&(this._callbackTick=e.tick)}return e.prototype.run=function(){return null==this._timer?(this._timer=new egret.Timer(1e3*this._interval,this._times),this._timer.addEventListener(egret.TimerEvent.TIMER,this._tick,this),this._timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this._fini,this)):(this._timer.stop(),this._timesRemains=this._timesRemains+this._times,this._timer.repeatCount=this._timesRemains),this._timer.start(),this._timer},e.prototype._tick=function(){this._timesRemains--,this._time=this._time+this._interval,this._callbackTick&&this._callbackTick.call(this._scope,this._time)},e.prototype._fini=function(){this.destroy(),this._callbackFinish.apply(this._scope)},e.prototype.destroy=function(){null!=this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this._tick,this),this._timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._fini,this),this._timer=null)},e}();e.StopWatch=t,__reflect(t.prototype,"Time.StopWatch");var i=function(){function e(e,t,i){this._time=e,this._scope=i,this._finish=t}return e.prototype.run=function(){this._nowTime=egret.getTimer(),egret.startTick(this._counter,this)},e.prototype._counter=function(e){var t=e,i=this._nowTime,n=t-i;
return n>=this._time&&(egret.stopTick(this._counter,this),this._finish.call(this._scope)),!1},e}();e.Timer=i,__reflect(i.prototype,"Time.Timer")}(Time||(Time={}));var Toast=function(e){function t(i,n,r){var s=e.call(this)||this;console.log("Toast:",i+" | "+n+" | "+r);var o=new egret.Bitmap(t._txtrToastBg);s.addChild(o);var a=new egret.TextField;return a.multiline=!0,a.size=50,a.bold=!0,a.textColor=16777215,a.stroke=2,a.strokeColor=0,a.text=i,a.fontFamily="微软雅黑",a.textAlign=egret.HorizontalAlign.CENTER,a.width=600,a.x=50,a.y=25,s.addChild(a),o.height=50+a.height,o.width=a.width+100,s.x=200,s.y=.618*r,s.alpha=0,console.log("this.width11 = "+o.width),egret.Tween.get(s).to({alpha:1},800,egret.Ease.quintOut).wait(1600).to({alpha:0},1200,egret.Ease.quintIn).call(function(){s.parent&&s.parent.removeChild(s)}),s}return __extends(t,e),t.init=function(e,t){console.log("Toast.init",t),this._cont=e,this._txtrToastBg=t},t.launch=function(e){if(this._cont){var i=new t(e,Constant.DESIGN_WID,Constant.DESIGN_HEI);this._cont.addChild(i)}},t}(egret.DisplayObjectContainer);__reflect(Toast.prototype,"Toast");var UIComponents;!function(e){var t=function(e){function t(t,i,n){var r=e.call(this)||this;return r.width=t,r.height=i,r._label=n,r.touchEnabled=!0,r.addEventListener(egret.Event.ADDED_TO_STAGE,r._onAddToStage,r),r}return __extends(t,e),t.prototype._onAddToStage=function(){var e=new egret.Bitmap;e.texture=RES.getRes("buttonBg_png");var t=new egret.Rectangle(30,35,196,33);e.scale9Grid=t,e.width=this.width,e.height=this.height,this.addChild(e);var i=new egret.TextField;i.width=this.width,i.height=this.height,i.textColor=TextColors.defaultButtonLable,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.text=this._label,i.bold=!0,this.addChild(i)},t}(egret.DisplayObjectContainer);e.DefaultButton=t,__reflect(t.prototype,"UIComponents.DefaultButton")}(UIComponents||(UIComponents={}));var Bitmap=egret.Bitmap,Usertop=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.initEui,t),t}return __extends(t,e),t.prototype.initEui=function(){this.addmoney.touchEnabled=!0,this.addmoney.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gotoShop,this),this.loadUserInfo(),this.getActionPoint(),this.avater.mask=this.avamask},t.prototype.gotoShop=function(){var e=new GameEvent(GameEvent.GAME_SHOPSKILL);this.dispatchEvent(e)},t.prototype.loadUserInfo=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget,n=JSON.parse(i.response);if(0==n.status){e.money=n.data.money,console.log("#####"+e.moneyText.text),e.moneyText.text=String(Number(e.money));var r=n.data.thumb;null!=r&&""!=r&&e.loadAvater(r),e.nickname=n.data.truename,e.nickText.text=e.nickname}else console.log("getuserinfo err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getUserinfoUrl();n=n+"&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.loadAvater=function(e){var t=this,i=new egret.ImageLoader;i.crossOrigin="anonymous",i.load(e),i.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){var i=new egret.Texture;i.bitmapData=e.currentTarget.data,t.avater.texture=i}},this)},t.prototype.countDown=function(){this.power>0?(this.power--,this.powerText.text=WxgUtils.getTimeStr(this.power)):(this.powerTimer.stop(),this.getActionPoint())},t.prototype.getActionPoint=function(){var e=this,t=new egret.HttpRequest,i=function(t){switch(t.type){case egret.Event.COMPLETE:var i=t.currentTarget,n=JSON.parse(i.response);if(0==n.status){for(var r=Number(n.data),s=0;r>s;s++)switch(s){case 0:e.power1.texture=RES.getRes("quqi_png");break;case 1:e.power2.texture=RES.getRes("quqi_png");break;case 2:e.power3.texture=RES.getRes("quqi_png");break;case 3:e.power4.texture=RES.getRes("quqi_png");break;case 4:e.power5.texture=RES.getRes("quqi_png")}var o=n.oversec;e.powerText.text=o,e.power=Number(o),Number(o)>0&&(e.powerTimer=new egret.Timer(1e3,0),e.powerTimer.addEventListener(egret.TimerEvent.TIMER,e.countDown,e),e.powerTimer.start()),console.log(r+" | "+o)}else console.log("getActionPoint err =>"+n.reason+","+n.status);break;case egret.IOErrorEvent.IO_ERROR:}};t.once(egret.Event.COMPLETE,i,e),t.once(egret.IOErrorEvent.IO_ERROR,i,e);var n=Constant.getActionpointUrl();n=n+"&"+WxgUtils.getTokenParam(),console.log("#"+n),t.open(n,egret.HttpMethod.GET),t.send()},t.prototype.init=function(){},t}(eui.Component);__reflect(Usertop.prototype,"Usertop",["eui.UIComponent","egret.DisplayObject"]);var Utils=function(){function e(){}return e.getBlockWidth=function(){if(0===e._blockWidth){var t=175/214,i=e.getBlockHeight()*t;e._blockWidth=i}return e._blockWidth},e.getBlockHeight=function(){return 0===e._blockHeight&&(e._blockHeight=Math.ceil((Constant.DESIGN_WID-(e.verticalMarginTop+e.verticalMarginBottom))/this.rows)),e._blockHeight},e.getArenaHeight=function(){return e.getBlockHeight()*e.rows},e.getArenaWidth=function(){return e.getBlockWidth()*e.columns},e.getStageWidth=function(){return 0===e._stageWidth&&(e._stageWidth=Constant.DESIGN_HEI),e._stageWidth},e.getStageHeight=function(){return 0===e._stageHeight&&(e._stageHeight=Constant.DESIGN_WID),e._stageHeight},e.getRowBlockState=function(t){if(null==e.rowsState[t]){for(var i=[],n=Math.floor(Math.random()*e.columns),r=0;r<e.columns;r++)r===n?i.push(BlockState.clickable):i.push(BlockState.unclickable);return e.rowsState[t]=i,i}return e.rowsState[t]},e.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.fitToWidth=function(e,t){e.width=t,e.height=t*e.texture.textureHeight/e.texture.textureWidth},e._blockWidth=0,e._blockHeight=0,e._stageHeight=0,e._stageWidth=0,e.verticalMarginTop=180,e.verticalMarginBottom=340,e.horizontalMargin=30,e.rowsState={},e.rows=6,e.columns=6,e.blockStyle="",e}();__reflect(Utils.prototype,"Utils");var WxgUtils=function(){function e(){}return e.getNowTimestamp=function(){return Date.parse((new Date).toString())/1e3},e.getTokenStr=function(){var e=egret.localStorage.getItem(Constant.G_TOKEN_KEY);return e},e.getTokenParam=function(){return"token="+egret.localStorage.getItem(Constant.G_TOKEN_KEY)+"&uname="+egret.localStorage.getItem(Constant.G_UNAME_KEY)},e.checkToken=function(){var t=egret.localStorage.getItem(Constant.G_TOKEN_KEY),i=egret.localStorage.getItem(Constant.G_TOKEN_EXPIRE_KEY);if(""==t||""==i||Number(i)<e.getNowTimestamp()+300){var n=new egret.HttpRequest,r=function(e){switch(e.type){case egret.Event.COMPLETE:var t=e.currentTarget,i=JSON.parse(t.response);0==i.status?(egret.localStorage.setItem(Constant.G_TOKEN_KEY,i.token),egret.localStorage.setItem(Constant.G_TOKEN_EXPIRE_KEY,i.expire)):console.log("gettoken err =>"+i.reason+","+i.status);break;case egret.IOErrorEvent.IO_ERROR:}};n.once(egret.Event.COMPLETE,r,self),n.once(egret.IOErrorEvent.IO_ERROR,r,self);var s=Constant.getGettokenUrl(),o=egret.localStorage.getItem(Constant.G_OPENID_KEY),a=egret.localStorage.getItem(Constant.G_UNAME_KEY);Constant.isdebug&&(""==o||null==o||null==a||""==a)&&(console.log("调用调试openid"),o="o7Vp401Z9LZaQoBfO1Zq_wfN7QSk",egret.localStorage.setItem(Constant.G_UNAME_KEY,"g1561620209406139")),s=s+"&openid="+o,n.open(s,egret.HttpMethod.GET),n.send()}},e.getTimeStr=function(e){var t=60,i=String(e);if(e>0){var n=parseInt(String(e/t)),r=parseInt(String(e-n*t));i=n+":"+r}return i},e.getYmd=function(e){var t=new Date(e),i=t.getFullYear(),n=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate();return i+"-"+n+"-"+r},e}();__reflect(WxgUtils.prototype,"WxgUtils");