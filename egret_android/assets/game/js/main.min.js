var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(s,r){function n(e){try{c(o.next(e))}catch(t){r(t)}}function l(e){try{c(o["throw"](e))}catch(t){r(t)}}function c(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(n,l)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return o([e,t])}}function o(i){if(s)throw new TypeError("Generator is already executing.");for(;c;)try{if(s=1,r&&(n=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(n=c.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(o){i=[6,o],r=0}finally{s=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,r,n,l,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return l={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},BlockBase=function(e){function t(t){var i=e.call(this)||this;i.active=!1,i._unClickableColor=RES.getRes(BlockTexture.unClickable),i._blockMargin=2,i._blockPadding=3,i._currentState=t.state,i._coverState=t.coverState,i.shrinkRate=t.shrinkRate,i.width=t.width,i.height=t.height,i._shrinkWidth=(i.width-2*(i._blockPadding+i._blockMargin))*i.shrinkRate,i._shrinkHeight=(i.height-2*(i._blockPadding+i._blockMargin))*i.shrinkRate,i._colorRect=new egret.Bitmap,i._colorRect.width=i._shrinkWidth,i._colorRect.height=i._shrinkHeight,i._coverRect=new egret.Bitmap,i._coverRect.width=i._shrinkWidth,i._coverRect.height=i._shrinkHeight,i._coverRect.touchEnabled=!0,i._backRect=Utils.createBitmapByName("blockFrame_png");var o=new egret.Rectangle(6,6,88,106);return i._backRect.scale9Grid=o,i._backRect.width=i.width-2*i._blockMargin,i._backRect.height=i.height-2*i._blockMargin,i._backRect.x=i._blockMargin,i._backRect.y=i._blockMargin,i._backRect.touchEnabled=!0,i._beforeDraw(),i._draw(),i._colorRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onTouch,i),i._coverRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onTouch,i),i._backRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onBackTouch,i),i}return __extends(t,e),t.prototype._draw=function(){null===this._backRect.parent&&this.addChild(this._backRect);var e=Utils.blockStyle;-1!==e.indexOf("rush")?this._colorRect.texture=this._clickableRushColor:this._colorRect.texture=this._clickableColor;var t=(BlockColor.border,this._shrinkWidth),i=this._shrinkHeight;this._currentState===BlockState.unclickable&&(t=this.width-2*(this._blockMargin+this._blockPadding),i=this.height-2*(this._blockMargin+this._blockPadding)),this._currentState===BlockState.clicked&&(t=this._colorRect.width,i=this._colorRect.height),this._currentState>0?-1!==e.indexOf("rush")?this._colorRect.texture=this._clickableRushColor:this._colorRect.texture=this._clickableColor:this._colorRect.texture=this._unClickableColor,this._colorRect.x=(this.width-t)/2,this._colorRect.y=(this.height-i)/2,this._colorRect.width=t,this._colorRect.height=i,null===this._colorRect.parent&&this.addChild(this._colorRect),this._currentState!==BlockState.unclickable&&(this._coverState===BlockCoverState.freezed?this._coverRect.texture=RES.getRes("ice_png"):this._coverRect.texture=null,this._coverRect.x=(this.width-t)/2,this._coverRect.y=(this.height-i)/2,this._coverRect.width=t,this._coverRect.height=i,null===this._coverRect.parent&&this.addChild(this._coverRect))},t.prototype._onTouch=function(e){this.active&&(this._currentState===BlockState.clickable?this._hit():this._currentState===BlockState.unclickable&&this._hitUnclickable())},t.prototype._onBackTouch=function(e){this.active&&this._hitUnclickable()},t.prototype._hitAni=function(){var e=this._colorRect.width*this.shrinkRate,t=this._colorRect.height*this.shrinkRate;if(this._currentState===BlockState.unclickable&&(e=this._colorRect.width,t=this._colorRect.height),e>0){var i=e-6;this._colorRect.width=i>0?i:0}if(t>0){var o=t-8;this._colorRect.height=o>0?o:0}return 0===e&&0===t?(egret.stopTick(this._hitAni,this),this.removeChild(this._colorRect)):this._draw(),!1},t.prototype._hit=function(){egret.startTick(this._hitAni,this),this.state="clicked";var e=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT);this.dispatchEvent(e)},t.prototype._hitUnclickable=function(){var e=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_UNCLICKABLE);this.dispatchEvent(e)},t.prototype.move=function(e,t){void 0===t&&(t="down"),this.speed=e,this._dir=t,egret.startTick(this._moveBlock,this)},t.prototype.stop=function(){egret.stopTick(this._moveBlock,this)},t.prototype._moveBlock=function(e){return"down"===this._dir?(this.y>=this.height&&this._triggerAllMovedInEvent(),this.y>=Utils.getArenaHeight()?this._triggerMovedOutEvent():this._setY()):(this.y<=Utils.getArenaHeight()-this.height&&this._triggerAllMovedInEvent(),this.y<=-this.height?this._triggerMovedOutEvent():this._setY()),!1},t.prototype._setY=function(){var e=this.y;"up"===this._dir?this.y=e-this.speed:this.y=e+this.speed},t.prototype._triggerMovedOutEvent=function(){var e=!1,t=new GameEvents.BlockEvent(GameEvents.BlockEvent.MOVED_OUT);this._currentState===BlockState.clickable&&(e=!0),t.missed=e,this.dispatchEvent(t)},t.prototype._triggerAllMovedInEvent=function(){var e=new GameEvents.BlockEvent(GameEvents.BlockEvent.ALL_MOVED_IN);this.dispatchEvent(e)},t.prototype.sizeUpdate=function(){this._shrinkWidth=this.width*this.shrinkRate-this._blockMargin,this._shrinkHeight=this.height*this.shrinkRate-this._blockMargin,this._currentState!==BlockState.clicked&&this._draw()},Object.defineProperty(t.prototype,"state",{get:function(){var e;return e=BlockState[this._currentState]},set:function(e){this._currentState=BlockState[e],this.graphics.clear(),this._draw()},enumerable:!0,configurable:!0}),t.prototype.freeze=function(){this._currentState!==BlockState.unclickable&&(this._coverState=BlockCoverState.freezed,this._coverRect.texture=RES.getRes("ice_png"))},t.prototype.cleanCover=function(){this._currentState!==BlockState.unclickable&&(this._coverRect.texture=null,this._coverState=BlockCoverState.normal)},t}(egret.Sprite);__reflect(BlockBase.prototype,"BlockBase");var BlockFlashBase=function(e){function t(t){var i=e.call(this,t)||this;return i._cachedClickableColor=i._clickableColor,i._cachedClickableRushColor=i._clickableRushColor,i._activeState=!0,i}return __extends(t,e),t.prototype._beforeDraw=function(){},t.prototype.move=function(t,i){void 0===i&&(i="down"),this._timeMark=egret.getTimer(),e.prototype.move.call(this,t,i)},t.prototype._moveBlock=function(t){var i=e.prototype._moveBlock.call(this,t),o=Utils.blockStyle;if("clickable"===this.state){var s=Math.floor((t-this._timeMark)/1e3);1===s&&(this._activeState=!this._activeState,this._activeState?-1!==o.indexOf("rush")?this._clickableRushColor=this._cachedClickableRushColor:this._clickableColor=this._cachedClickableColor:-1!==o.indexOf("rush")?this._clickableRushColor=RES.getRes(BlockTexture.clickableNormalRushStyle):this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._draw(),this._timeMark=t)}return i},t}(BlockBase);__reflect(BlockFlashBase.prototype,"BlockFlashBase");var MagicBase=function(e){function t(){var t=e.call(this)||this;t._zoomRate=.4;var i=Utils.createBitmapByName("rock_bg_png");i.scaleX=t._zoomRate,i.scaleY=t._zoomRate,t._bg=i,t._drawIcon();var o=t._getIconOffset();return t.icon.x=-o.offsetX,i.y=o.offsetY,t.addChildAt(i,0),t.touchEnabled=!0,t}return __extends(t,e),t.prototype._drawIcon=function(){},t.prototype._getIconOffset=function(){},t.prototype.getBaseWidth=function(){return this._bg.width*this._zoomRate},t}(egret.Sprite);__reflect(MagicBase.prototype,"MagicBase");var Login=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.autoFitStage,t),t.addEventListener(eui.UIEvent.CREATION_COMPLETE,t.resize,t),t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.autoFitStage=function(){this.height=Utils.getStageHeight(),this.width=Utils.getStageWidth()},t.prototype.resize=function(){Utils.fitToWidth(this.bgIMG,this.width)},t}(eui.Component);__reflect(Login.prototype,"Login",["eui.UIComponent","egret.DisplayObject"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function o(o){t.call(i,o,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?o(s):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BlockNormal=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._clickableRushColor=RES.getRes(BlockTexture.clickableNormalRushStyle)},t}(BlockBase);__reflect(BlockNormal.prototype,"BlockNormal");var BlockRush=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableRushRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableRush)},t.prototype._hit=function(){if(e.prototype._hit.call(this),this._activeState){var t=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_RUSH);this.dispatchEvent(t)}},t}(BlockFlashBase);__reflect(BlockRush.prototype,"BlockRush");var BlocksColumn=function(e){function t(t){var i=e.call(this)||this;return i._blocks=[],i._initialBlocks=[],i._creatingRowIndex=0,i._speedLevel=0,i._speedTick=!1,i._shrinkRate=1,i._blockCoverState=BlockCoverState.normal,i.speed=Service.GAME_CONFIG.speedLevels[i._speedLevel],i.dir=t.dir,i._dir=i.dir,i.name=t.name,i.blockWeightNumber=t.blockWeightNumber,i._speedUpInterval=1e3*t.speedUpInterval,i._index=parseInt(i.name.split("_")[1],10),i._draw(),i}return __extends(t,e),t.prototype._draw=function(){this._blocks=[],this._initialBlocks=[];for(var e="down"===this._dir?-1:0,t="down"===this._dir?Utils.rows:Utils.rows+1,i=e;t>i;i++){var o=BlockState.unclickable;this._creatingRowIndex="down"===this._dir?i+1:i,("down"===this._dir&&-1===i||"up"===this._dir&&i===t-1)&&(o=Utils.getRowBlockState(this._creatingRowIndex)[this._index]);var s=this._createBlock({state:o,startBlock:!0,coverState:this._blockCoverState});this.addChild(s),s.x=0,s.y=i*s.height,this._blocks.push(s),this._initialBlocks.push(s)}},t.prototype.reset=function(){this.stop(),this.speedLevel=0,this._blockCoverState=BlockCoverState.normal,this._dir=this.dir,this.shrinkReset();for(var e=this._blocks.length,t=0;e>t;t++)this.removeChild(this._blocks[t]),this._blocks[t]=null;this._draw()},t.prototype._createBlock=function(e){var t,i=Utils.getBlockWidth(),o=Utils.getBlockHeight(),s={width:i,height:o,shrinkRate:this._shrinkRate,state:e.state,coverState:e.coverState};if(null==e.startBlock&&e.state===BlockState.clickable)if(-1===Utils.blockStyle.indexOf("quell")){var r=[];for(var n in this._blockWeightNumber)if(this._blockWeightNumber.hasOwnProperty(n))for(var l=this._blockWeightNumber[n],c=0;l>c;c++)r.push(BlockType[n]);10!==r.length&&(r=[0,0,0,0,0,0,0,0,0,0]);var a=r,h=Math.floor(Math.random()*a.length),_=a[h];t=new window[BlockType[_]](s)}else t=new BlockNormal(s);else t=new BlockNormal(s);return e.startBlock||(t.active=!0),t.addEventListener(GameEvents.BlockEvent.MOVED_OUT,this._onMovedOut,this),t.addEventListener(GameEvents.BlockEvent.ALL_MOVED_IN,this._onAllMovedIn,this),t},t.prototype._onAllMovedIn=function(e){var t,i=e.target,o=i.y;if(-1!==Utils.blockStyle.indexOf("destroy")&&("clickable"===i.state||i instanceof BlockBlink||i instanceof BlockShrink)){for(var s=0;s<this._blocks.length;s++)if(this._blocks[s]===i){t=s;break}i.stop(),this.removeChild(i),i=null;var r=this._createBlock({state:BlockState.unclickable});this.addChild(r),r.x=0,r.y=o,r.move(this.speed,this._dir),this._blocks[t]=r;var n=new GameEvents.PlayEvent(GameEvents.PlayEvent.SCORE);n.score=1,this.dispatchEvent(n)}},t.prototype._onMovedOut=function(e){var t=e.target,i=!1;if(t.removeEventListener(GameEvents.BlockEvent.MOVED_OUT,this._onMovedOut,this),"down"===this._dir?this._blocks.pop():this._blocks.shift(),t.stop(),this.removeChild(t),t=null,i)this.stop();else{var o=this._createBlock({state:Utils.getRowBlockState(this._creatingRowIndex)[this._index],coverState:this._blockCoverState});this._creatingRowIndex++,this.addChildAt(o,0),"down"===this._dir?o.y=this._blocks[0].y-o.height+this.speed:o.y=this._blocks[this._blocks.length-1].y+o.height-this.speed,o.move(this.speed,this._dir),"down"===this._dir?this._blocks.unshift(o):this._blocks.push(o)}},t.prototype._speedLooper=function(){-1==Utils.blockStyle.indexOf("freeze")&&(this._speedTick?this._slowDown():this._speedUp())},t.prototype._speedUp=function(){this._speedLevel<Service.GAME_CONFIG.speedLevels.length&&(this._CalculateSpeed(),this.updateSpeed(),this._speedLevel++),this._speedLevel===Service.GAME_CONFIG.speedLevels.length&&(this._speedTick=!0)},t.prototype._CalculateSpeed=function(){-1!==Utils.blockStyle.indexOf("rush")?this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel]*Service.GAME_CONFIG.rushFactor:this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel]},t.prototype._slowDown=function(){this._speedLevel>0&&(this._speedLevel--,this._CalculateSpeed(),this.updateSpeed()),0===this._speedLevel&&(this._speedTick=!1,this._reversePause())},t.prototype._revertDir=function(){"up"===this._dir?this._dir="down":this._dir="up",this.move()},t.prototype._reversePause=function(){egret.startTick(this._checkPauseToFit,this)},t.prototype._checkPauseToFit=function(){var e=this._blocks.length,t=0;"down"===this._dir&&(t=e-1);var i="down"===this._dir&&this._blocks[t].y>=Utils.getArenaHeight(),o="up"===this._dir&&this._blocks[t].y<=-this._blocks[t].height;return(i||o)&&(egret.stopTick(this._checkPauseToFit,this),this._excuteReversePause()),!1},t.prototype._excuteReversePause=function(){this.stop(),console.log(this._blocks),null==this._reverseTimer&&(this._reverseTimer=new egret.Timer(2e3,1),this._reverseTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this._revertDir,this)),this._reverseTimer.reset(),this._reverseTimer.start()},t.prototype._blockSizeUpdate=function(){for(var e=0;e<this._blocks.length;e++){var t=this._blocks[e];t.shrinkRate=this._shrinkRate,t.sizeUpdate()}},t.prototype.updateSpeed=function(){for(var e=this._blocks,t=0;t<e.length;t++)e[t].speed=this.speed},t.prototype.startSpeedUpTimer=function(){this._speedUpTimer=new egret.Timer(this._speedUpInterval,0),this._speedUpTimer.addEventListener(egret.TimerEvent.TIMER,this._speedLooper,this),this._speedUpTimer.start()},t.prototype.stopSpeedUpTimer=function(){null!=this._speedUpTimer&&(this._speedUpTimer.stop(),this._speedUpTimer.removeEventListener(egret.TimerEvent.TIMER,this._speedLooper,this),this._speedUpTimer=null),this._speedTick=!1},t.prototype._stopReverseTimer=function(){null!=this._reverseTimer&&(this._reverseTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._revertDir,this),this._reverseTimer=null)},t.prototype.move=function(e){void 0===e&&(e=!1);for(var t=this._blocks,i=0;i<t.length;i++)t[i].move(this.speed,this._dir),e&&(t[i].active=!0);this.startSpeedUpTimer()},t.prototype.stop=function(e){void 0===e&&(e=!1);for(var t=0;t<this._blocks.length;t++)this._blocks[t].stop(),e&&(this._blocks[t].active=!1);this.stopSpeedUpTimer(),this._stopReverseTimer()},t.prototype.shrink=function(){this._shrinkRate=.5,this._blockSizeUpdate()},t.prototype.shrinkReset=function(){this._shrinkRate=1,this._blockSizeUpdate()},Object.defineProperty(t.prototype,"speedLevel",{get:function(){return this._speedLevel},set:function(e){this._speedLevel=e,this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blockWeightNumber",{get:function(){return this._blockWeightNumber},set:function(e){this._blockWeightNumber=e},enumerable:!0,configurable:!0}),t.prototype.freezeBlocks=function(){this._blockCoverState=BlockCoverState.freezed;for(var e=this._blocks,t=0;t<e.length;t++)e[t].freeze()},t.prototype.unFreezeBlocks=function(){this._blockCoverState=BlockCoverState.normal;for(var e=this._blocks,t=0;t<e.length;t++)e[t].cleanCover()},t.prototype.quell=function(){for(var e=this._blocks,t=0;t<e.length;t++){var i=e[t],o=i.y;if("clickable"===i.state||i instanceof BlockBlink||i instanceof BlockShrink){i.stop(),this.removeChild(i),i=null;var s=this._createBlock({state:BlockState.clickable});this.addChild(s),s.x=0,s.y=o,s.move(this.speed,this._dir),this._blocks[t]=s}}},t.prototype.purify=function(){for(var e=this._blocks,t=0;t<e.length;t++){var i=e[t],o=i.y;if("clickable"===i.state||i instanceof BlockBlink||i instanceof BlockShrink){i.stop(),this.removeChild(i),i=null;var s=this._createBlock({state:BlockState.unclickable});this.addChild(s),s.x=0,s.y=o,s.move(this.speed,this._dir),this._blocks[t]=s}}},t.prototype.destroy=function(){for(var e=this._blocks,t=0,i=0;i<e.length;i++){var o=e[i],s=o.y;if("clickable"===o.state||o instanceof BlockBlink||o instanceof BlockShrink){o.stop(),this.removeChild(o),o=null;var r=this._createBlock({state:BlockState.unclickable});this.addChild(r),r.x=0,r.y=s,r.move(this.speed,this._dir),this._blocks[i]=r,t++}}return t},t}(egret.Sprite);__reflect(BlocksColumn.prototype,"BlocksColumn");var BlockShrink=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableShrinkRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableShrink)},t.prototype._hit=function(){if(e.prototype._hit.call(this),this._activeState){var t=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_SHRINK);this.dispatchEvent(t)}},t}(BlockFlashBase);__reflect(BlockShrink.prototype,"BlockShrink");var BlockState;!function(e){e[e.unclickable=0]="unclickable",e[e.clicked=1]="clicked",e[e.clickable=2]="clickable",e[e.clickableDouble=3]="clickableDouble",e[e.clickableRush=4]="clickableRush"}(BlockState||(BlockState={}));var BlockColor;!function(e){e[e.unClickable=16777215]="unClickable",e[e.clickable=0]="clickable",e[e.clicked=15066597]="clicked",e[e.border=6710886]="border",e[e.clickableDouble=1782970]="clickableDouble",e[e.clickableRush=12000541]="clickableRush",e[e.clickableBlink=9688320]="clickableBlink",e[e.clickableShrink=13172991]="clickableShrink"}(BlockColor||(BlockColor={}));var BlockTexture;!function(e){e.unClickable="b_normal_png",e.clicked="block_clicked",e.clickableDouble="b_blue_png",e.clickableRush="b_red_png",e.clickableBlink="b_yellow_png",e.clickableShrink="b_purple_png",e.clickableNormal="b_black_png",e.clickableNormalRushStyle="b_black_rush_png",e.clickableShrinkRushStyle="b_purple_rush_png",e.clickableBlinkRushStyle="b_yellow_rush_png",e.clickableRushRushStyle="b_red_rush_png",e.clickableDoubleRushStyle="b_blue_rush_png"}(BlockTexture||(BlockTexture={}));var BlockType;!function(e){e[e.BlockNormal=0]="BlockNormal",e[e.BlockDouble=1]="BlockDouble",e[e.BlockRush=2]="BlockRush",e[e.BlockBlink=3]="BlockBlink",e[e.BlockShrink=4]="BlockShrink",e[e.BlockBonus=5]="BlockBonus"}(BlockType||(BlockType={}));var BlockStyle;!function(e){e[e.Default=0]="Default",e[e.Rush=1]="Rush"}(BlockStyle||(BlockStyle={}));var GameMode;!function(e){e[e.BI_DIR=0]="BI_DIR",e[e.DOWN=1]="DOWN",e[e.UP=2]="UP"}(GameMode||(GameMode={}));var GameLevel;!function(e){e[e.EASY=0]="EASY",e[e.NORMAL=1]="NORMAL",e[e.HARD=2]="HARD"}(GameLevel||(GameLevel={}));var TextColors;!function(e){e[e.defaultButtonLable=16777215]="defaultButtonLable"}(TextColors||(TextColors={}));var BlockCoverState;!function(e){e[e.normal=0]="normal",e[e.freezed=1]="freezed"}(BlockCoverState||(BlockCoverState={}));var GameEvents;!function(e){var t=function(e){function t(t,i,o){void 0===i&&(i=!0),void 0===o&&(o=!1);var s=e.call(this,t,i,o)||this;return s.missed=!1,s}return __extends(t,e),t.MOVED_OUT="movedout",t.ALL_MOVED_IN="allmovedin",t.MISSED="missed",t.HIT="hit",t.HIT_RUSH="hitrush",t.HIT_SHRINK="hitshrink",t.HIT_UNCLICKABLE="hitunclickable",t}(egret.Event);e.BlockEvent=t,__reflect(t.prototype,"GameEvents.BlockEvent");var i=function(e){function t(t,i,o){void 0===i&&(i=!0),void 0===o&&(o=!1);var s=e.call(this,t,i,o)||this;return s.score=0,s}return __extends(t,e),t.GAME_OVER="gameover",t.SCORE="score",t}(egret.Event);e.PlayEvent=i,__reflect(i.prototype,"GameEvents.PlayEvent");var o=function(e){function t(t,i,o){return void 0===i&&(i=!0),void 0===o&&(o=!1),e.call(this,t,i,o)||this}return __extends(t,e),t.UNFREEZE="unfreeze",t.UNQUELL="unquell",t.UNPURIFY="unpurify",t.DESTROY="destroy",t}(egret.Event);e.MagicEvent=o,__reflect(o.prototype,"GameEvents.MagicEvent")}(GameEvents||(GameEvents={}));var GameScene=function(e){function t(t){var i=e.call(this)||this;return i._blockColumns=[],i._columnSpeeds=[],i._difficulty=0,i._bgm=RES.getRes("midnight-ride_mp3"),i._freezeSound=RES.getRes("iceCracking_mp3"),i._windSound=RES.getRes("wind_mp3"),i.started=!1,i._FreezeEffectMCs=[],i._QuellEffectMCs=[],i._mode=t.mode,i._level=t.level,i._rushFactor=Service.GAME_CONFIG.rushFactor,i._rushTime=Service.GAME_CONFIG.rushTime,i._shrinkTime=Service.GAME_CONFIG.shrinkTime,i._levelUpTime=Service.GAME_CONFIG.levelUpInterval,i._calculateColsRows(),i._drawColumns(),i.width=Utils.getArenaWidth(),i.height=Utils.getArenaHeight(),i.scrollRect=new egret.Rectangle(0,0,i.width,i.height),i.addEventListener(GameEvents.BlockEvent.MOVED_OUT,i._onMovedOut,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_RUSH,i._onHitRush,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_UNCLICKABLE,i._onHitUnclickable,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_SHRINK,i._onHitShrink,i,!0),document.addEventListener("pause",i._onPause.bind(i),!1),document.addEventListener("resume",i._onResume.bind(i),!1),i}return __extends(t,e),t.prototype._onPause=function(){this._stopbgm(),this._effectChanel.stop()},t.prototype._onResume=function(){this.started&&this._playbgm(),"freeze"===Utils.blockStyle&&this._freezeSound.play(0,0)},t.prototype._drawColumns=function(){for(var e,t=["up","down"],i=Utils.getBlockWidth(),o=0;o<Utils.columns;o++){var s="up";this._mode===GameMode.BI_DIR?s=t[Math.floor(2*Math.random())]:this._mode===GameMode.DOWN&&(s=t[1]),e=new BlocksColumn({dir:s,speedUpInterval:Service.GAME_CONFIG.colmuns[o].interval,name:"col_"+o,blockWeightNumber:Service.GAME_CONFIG.difficulty[this._difficulty]}),e.x=o*i,e.width=i,this.addChildAt(e,1),this._blockColumns.push(e)}},t.prototype._calculateColsRows=function(){Utils.columns=4,Utils.rows=5},t.prototype._onMovedOut=function(e){},t.prototype._onHitRush=function(e){if(null==this._rushWatch){this._rushWatch=new Time.StopWatch({times:this._rushTime,finish:this._stopRush},this),-1==Utils.blockStyle.indexOf("freeze")&&(this._columnSpeeds=[]);for(var t=0;t<this._blockColumns.length;t++)if(-1==Utils.blockStyle.indexOf("freeze")){var i=this._blockColumns[t].speed;this._columnSpeeds.push(i),this._blockColumns[t].speed=i*this._rushFactor,this._blockColumns[t].updateSpeed()}}this._rushWatch.run();Utils.blockStyle=Utils.blockStyle+"rush"},t.prototype._stopRush=function(){if(-1==Utils.blockStyle.indexOf("freeze"))for(var e=0;e<this._blockColumns.length;e++){var t=this._columnSpeeds[e];this._blockColumns[e].speed=t,this._blockColumns[e].updateSpeed()}this._rushWatch=null,Utils.blockStyle=Utils.blockStyle.replace(/rush/g,"")},t.prototype._onHitUnclickable=function(){this._gameOver()},t.prototype._onHitShrink=function(){if(null==this._shrinkWatch){this._shrinkWatch=new Time.StopWatch({times:this._shrinkTime,finish:this._stopShrink},this);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].shrink()}this._shrinkWatch.run()},t.prototype._stopShrink=function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].shrinkReset();this._shrinkWatch=null},t.prototype.gameStart=function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].move(!0);this._startLevelUp(),this._playbgm(),this.started=!0},t.prototype._gameOver=function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].stop(!0);var t=new GameEvents.PlayEvent(GameEvents.PlayEvent.GAME_OVER);this.dispatchEvent(t),this._stopbgm(),this._stopeffect(),this.started=!1,Utils.blockStyle=""},t.prototype._startLevelUp=function(){null==this._levelUpWatch&&(this._levelUpWatch=new Time.StopWatch({times:Service.GAME_CONFIG.difficulty.length,finish:this._stopLevelUp,interval:this._levelUpTime,tick:this.levelUp},this));this._levelUpWatch.run()},t.prototype._stopLevelUp=function(){this._levelUpWatch=null},t.prototype.levelUp=function(e){this._difficulty<Service.GAME_CONFIG.difficulty.length-1&&this._difficulty++,console.log(this._difficulty);for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].blockWeightNumber=Service.GAME_CONFIG.difficulty[this._difficulty]},t.prototype._playbgm=function(){this._bgmChanel=this._bgm.play(0,0)},t.prototype._stopbgm=function(){this._bgmChanel.stop()},t.prototype._stopeffect=function(){this._effectChanel&&this._effectChanel.stop()},t.prototype.reset=function(e){void 0===e&&(e=!1),this._difficulty=0,Utils.rowsState={};for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].blockWeightNumber=Service.GAME_CONFIG.difficulty[this._difficulty],this._blockColumns[t].reset();e||(null!=this._rushWatch&&(this._rushWatch.destroy(),this._rushWatch=null),null!=this._freezeWatch&&(this._freezeWatch.destroy(),this._freezeWatch=null),null!=this._quellWatch&&(this._quellWatch.destroy(),this._quellWatch=null),null!=this._purifyWatch&&(this._purifyWatch.destroy(),this._purifyWatch=null),null!=this._destroyWatch&&(this._destroyWatch.destroy(),this._destroyWatch=null),null!=this._shrinkWatch&&(this._shrinkWatch.destroy(),this._shrinkWatch=null),null!=this._levelUpWatch&&(this._levelUpWatch.destroy(),this._levelUpWatch=null),Utils.blockStyle="")},t.prototype._resetSpeedAndDifficulty=function(){this.reset(!0);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].move(!0)},t.prototype._unFreeze=function(){this._effectChanel.stop();for(var e=0;e<this._blockColumns.length;e++){var t=this._columnSpeeds[e];this._blockColumns[e].speed=t,this._blockColumns[e].updateSpeed(),this._blockColumns[e].unFreezeBlocks()}Utils.blockStyle=Utils.blockStyle.replace(/freeze/g,""),this._freezeWatch=null;var i=new GameEvents.MagicEvent(GameEvents.MagicEvent.UNFREEZE);this.dispatchEvent(i)},t.prototype._pauseMove=function(e,t){for(var i=0;i<this._blockColumns.length;i++)this._blockColumns[i].stop(!0);var o=new Time.Timer(e,function(){for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].move(!0);t.call(this)},this);o.run()},t.prototype.freeze=function(){var e=this;if(this._effectChanel=this._windSound.play(0,1),0===this._FreezeEffectMCs.length){var t=RES.getRes("Freeze1_json"),i=RES.getRes("Freeze1_png"),o=new egret.MovieClipDataFactory(t,i),s=new egret.MovieClip(o.generateMovieClipData("Freeze")),r=RES.getRes("Freeze2_json"),n=RES.getRes("Freeze2_png"),l=new egret.MovieClipDataFactory(r,n),c=new egret.MovieClip(l.generateMovieClipData("Freeze")),a=RES.getRes("Freeze3_json"),h=RES.getRes("Freeze3_png"),_=new egret.MovieClipDataFactory(a,h),u=new egret.MovieClip(_.generateMovieClipData("Freeze")),p=Utils.getArenaWidth(),d=Utils.getArenaHeight(),g=p/360,f=d/640;s.scaleX=g,s.scaleY=f,c.scaleX=g,c.scaleY=f,u.scaleX=g,u.scaleY=f,s.addEventListener(egret.Event.COMPLETE,function(t){console.log(s),e.removeChild(s),e.addChild(c),c.gotoAndPlay(0)},this),c.addEventListener(egret.Event.COMPLETE,function(t){e.removeChild(c),e.addChild(u),u.gotoAndPlay(0)},this),u.addEventListener(egret.Event.COMPLETE,function(t){e.removeChild(u)},this),this._FreezeEffectMCs=[s,c,u]}this.addChild(this._FreezeEffectMCs[0]),this._FreezeEffectMCs[0].gotoAndPlay(0),this._pauseMove(4e3,function(){if(this._effectChanel=this._freezeSound.play(0,0),null==this._freezeWatch){this._freezeWatch=new Time.StopWatch({times:this._rushTime,finish:this._unFreeze},this),this._columnSpeeds=[];for(var e=0;e<this._blockColumns.length;e++){var t=this._blockColumns[e].speed;this._columnSpeeds.push(t),this._blockColumns[e].speed=1,this._blockColumns[e].updateSpeed(),this._blockColumns[e].freezeBlocks()}}this._freezeWatch.run()})},t.prototype._unQuell=function(){Utils.blockStyle=Utils.blockStyle.replace(/quell/g,""),this._quellWatch=null;var e=new GameEvents.MagicEvent(GameEvents.MagicEvent.UNQUELL);this.dispatchEvent(e)},t.prototype.quell=function(){if(null==this._quellWatch){this._quellWatch=new Time.StopWatch({times:this._rushTime,finish:this._unQuell},this);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].quell()}this._quellWatch.run()},t.prototype.purify=function(){if(null==this._purifyWatch){this._purifyWatch=new Time.StopWatch({times:this._rushTime,finish:this._unPurify},this);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].purify();this._resetSpeedAndDifficulty()}this._purifyWatch.run()},t.prototype._unPurify=function(){Utils.blockStyle=Utils.blockStyle.replace(/purify/g,""),this._purifyWatch=null;var e=new GameEvents.MagicEvent(GameEvents.MagicEvent.UNPURIFY);this.dispatchEvent(e)},t.prototype.destroy=function(e){if(null==this._destroyWatch){this._destroyWatch=new Time.StopWatch({times:this._rushTime,finish:this._unDestroy},this);for(var t=0,i=0;i<this._blockColumns.length;i++)t+=this._blockColumns[i].destroy();e.score=e.score+t}this._destroyWatch.run()},t.prototype._unDestroy=function(){Utils.blockStyle=Utils.blockStyle.replace(/destroy/g,""),this._destroyWatch=null;var e=new GameEvents.MagicEvent(GameEvents.MagicEvent.DESTROY);this.dispatchEvent(e)},t}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");var GameScreen=function(e){function t(t){void 0===t&&(t={});var i=e.call(this)||this;return i._drawBg(),i._drawGameScene(),i._drawScore(),i._drawMagics(),i.addEventListener(GameEvents.BlockEvent.HIT,i._onHit,i,!0),i.addEventListener(GameEvents.PlayEvent.GAME_OVER,i._gameOver,i),i.addEventListener(GameEvents.MagicEvent.UNFREEZE,i._enableMagic,i),i.addEventListener(GameEvents.MagicEvent.UNQUELL,i._enableMagic,i),i.addEventListener(GameEvents.MagicEvent.UNPURIFY,i._enableMagic,i),i.addEventListener(GameEvents.MagicEvent.DESTROY,i._enableMagic,i),i.addEventListener(GameEvents.PlayEvent.SCORE,i._onMagicScore,i,!0),i}return __extends(t,e),t.prototype._drawBg=function(){this._bg=Utils.createBitmapByName("bg_png");var e=Utils.getStageWidth(),t=Utils.getStageHeight(),i=e/this._bg.texture.bitmapData.width,o=t/this._bg.texture.bitmapData.height;this._bg.width=e,this._bg.height=t,this.addChild(this._bg);var s=RES.getRes("shanguang_json"),r=RES.getRes("shanguang_png"),n=new egret.MovieClipDataFactory(s,r),l=new egret.MovieClip(n.generateMovieClipData("shanguang"));l.x=425*i,l.y=1415*o,l.scaleX=i,l.scaleY=o,this.addChild(l),l.gotoAndPlay("shan",-1)},t.prototype._drawGameScene=function(){var e=new GameScene({mode:GameMode.DOWN,level:GameLevel.EASY});this._gameScene=e,this._gameScene.x=(Utils.getStageWidth()-Utils.getArenaWidth())/2,this._gameScene.y=Utils.verticalMarginTop,this.addChild(e)},t.prototype._drawMagics=function(){var e=0;this._magicFreeze=new MagicFreeze;var t=this._magicFreeze.getBaseWidth(),i=(Utils.getStageWidth()-2*Utils.horizontalMargin-4*t)/3;
this._magicFreeze.anchorOffsetY=this._magicFreeze.height,this._magicFreeze.x=e*(i+t)+Utils.horizontalMargin,this._magicFreeze.y=Utils.getStageHeight()-20,this.addChild(this._magicFreeze),this._magicFreeze.addEventListener(egret.TouchEvent.TOUCH_TAP,this._freeze,this),e++,this._magicQuell=new MagicQuell,this._magicQuell.anchorOffsetY=this._magicQuell.height,this._magicQuell.x=e*(i+t)+Utils.horizontalMargin,this._magicQuell.y=Utils.getStageHeight()-20,this.addChild(this._magicQuell),this._magicQuell.addEventListener(egret.TouchEvent.TOUCH_TAP,this._quell,this),e++,this._magicPurify=new MagicPurify,this._magicPurify.anchorOffsetY=this._magicPurify.height,this._magicPurify.x=e*(i+t)+Utils.horizontalMargin,this._magicPurify.y=Utils.getStageHeight()-20,this.addChild(this._magicPurify),this._magicPurify.addEventListener(egret.TouchEvent.TOUCH_TAP,this._purify,this),e++,this._magicDestroy=new MagicDestroy,this._magicDestroy.anchorOffsetY=this._magicDestroy.height,this._magicDestroy.x=e*(i+t)+Utils.horizontalMargin,this._magicDestroy.y=Utils.getStageHeight()-20,this.addChild(this._magicDestroy),this._magicDestroy.addEventListener(egret.TouchEvent.TOUCH_TAP,this._destroy,this)},t.prototype._onHit=function(e){this._score.score=this._score.score+1},t.prototype._drawScore=function(){this._score=new Score,this.addChild(this._score)},t.prototype._gameOver=function(){console.log(this._score.score)},t.prototype._handleMagicsState=function(e){for(var t=[this._magicFreeze,this._magicQuell,this._magicPurify,this._magicDestroy],i=t.length,o=0;i>o;o++)e?t[o].enable():t[o].disable()},t.prototype._freeze=function(){this._gameScene.started&&-1===Utils.blockStyle.indexOf("freeze")&&(Utils.blockStyle=Utils.blockStyle+"freeze",this._handleMagicsState(),this._gameScene.freeze())},t.prototype._enableMagic=function(){this._handleMagicsState(!0)},t.prototype._quell=function(){this._gameScene.started&&-1===Utils.blockStyle.indexOf("quell")&&(Utils.blockStyle=Utils.blockStyle+"quell",this._handleMagicsState(),this._gameScene.quell())},t.prototype._purify=function(){this._gameScene.started&&-1===Utils.blockStyle.indexOf("purify")&&(Utils.blockStyle=Utils.blockStyle+"purify",this._handleMagicsState(),this._gameScene.purify())},t.prototype._destroy=function(){this._gameScene.started&&-1===Utils.blockStyle.indexOf("destroy")&&(Utils.blockStyle=Utils.blockStyle+"destroy",this._handleMagicsState(),this._gameScene.destroy(this._score))},t.prototype._onMagicScore=function(e){var t=e.score;this._score.score=this._score.score+t},t.prototype.reset=function(){this._score.score=0,this._gameScene.reset(),this._handleMagicsState(!0)},Object.defineProperty(t.prototype,"gameScene",{get:function(){return this._gameScene},enumerable:!0,configurable:!0}),t}(egret.Sprite);__reflect(GameScreen.prototype,"GameScreen");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading resources..."+e+"/"+t},t.prototype.onRemoteProgress=function(e,t){this.textField.text="Loading configuration..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var BlockBlink=function(e){function t(t){var i=e.call(this,t)||this;return i._activeState=!0,i}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableBlinkRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableBlink)},t.prototype.move=function(t,i){void 0===i&&(i="down"),this._timeMark=egret.getTimer(),e.prototype.move.call(this,t,i)},t.prototype._moveBlock=function(t){var i=e.prototype._moveBlock.call(this,t);if("clicked"!==this.state){var o=Math.floor((t-this._timeMark)/1e3);1===o&&(this._activeState=!this._activeState,this._activeState?this.state="clickable":this.state="unclickable",this._timeMark=t)}return i},t}(BlockBase);__reflect(BlockBlink.prototype,"BlockBlink");var BlockDouble=function(e){function t(t){var i=e.call(this,t)||this;return i._clickCount=0,i}return __extends(t,e),t.prototype._beforeDraw=function(){this._clickableRushColor=RES.getRes(BlockTexture.clickableDoubleRushStyle),this._clickableColor=RES.getRes(BlockTexture.clickableDouble)},t.prototype._onTouch=function(e){var t=Utils.blockStyle;this._currentState===BlockState.clickable&&(this._clickCount++,1===this._clickCount?(-1!==t.indexOf("rush")?this._clickableRushColor=RES.getRes(BlockTexture.clickableNormalRushStyle):this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._draw()):2===this._clickCount&&this._hit())},t}(BlockBase);__reflect(BlockDouble.prototype,"BlockDouble");var MagicDestroy=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("nuke_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:12,offsetY:this.icon.height*this._zoomRate-12}},t.prototype.disable=function(){this.icon.texture=RES.getRes("nuke_disabled_png")},t.prototype.enable=function(){this.icon.texture=RES.getRes("nuke_png")},t}(MagicBase);__reflect(MagicDestroy.prototype,"MagicDestroy");var MagicFreeze=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("freeze_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:15,offsetY:this.icon.height*this._zoomRate-19}},t.prototype.disable=function(){this.icon.texture=RES.getRes("freeze_disabled_png")},t.prototype.enable=function(){this.icon.texture=RES.getRes("freeze_png")},t}(MagicBase);__reflect(MagicFreeze.prototype,"MagicFreeze");var MagicPurify=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("purify_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:3,offsetY:this.icon.height*this._zoomRate-12}},t.prototype.disable=function(){this.icon.texture=RES.getRes("purify_disabled_png")},t.prototype.enable=function(){this.icon.texture=RES.getRes("purify_png")},t}(MagicBase);__reflect(MagicPurify.prototype,"MagicPurify");var MagicQuell=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype._drawIcon=function(){var e=Utils.createBitmapByName("skull_png");e.scaleX=this._zoomRate,e.scaleY=this._zoomRate,this.icon=e,this.addChild(e)},t.prototype._getIconOffset=function(){return{offsetX:3,offsetY:this.icon.height*this._zoomRate-12}},t.prototype.disable=function(){this.icon.texture=RES.getRes("skull_disabled_png")},t.prototype.enable=function(){this.icon.texture=RES.getRes("skull_png")},t}(MagicBase);__reflect(MagicQuell.prototype,"MagicQuell");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),[4,this.createGameScene()];case 2:return t.sent(),this._attachEvents(),[4,platform.login()];case 3:return t.sent(),[4,platform.getUserInfo()];case 4:return e=t.sent(),console.log(e),[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return s.sent(),[4,this.loadTheme()];case 2:return s.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return s.sent(),t=new Service(e),[4,t.getGameConfig()];case 4:return i=s.sent(),this.stage.removeChild(e),[3,6];case 5:return o=s.sent(),console.error(o),[3,6];case 6:return[2]}})})},t.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,o,s,r;return __generator(this,function(n){return this.stage.setContentSize(window.innerWidth,window.innerHeight),this._GameScreen=new GameScreen,this.addChild(this._GameScreen),e=Utils.getStageWidth()/2,console.log(Utils.getStageWidth()),t=80,i=new UIComponents.DefaultButton(e,t,"Start"),i.x=Utils.getStageWidth()/2-e/2,i.y=.3*Utils.getStageHeight(),i.addEventListener("touchTap",this._startGame,this),this._startButton=i,this.addChild(i),o=Utils.getStageWidth()/2,s=80,r=new UIComponents.DefaultButton(o,s,"Game over"),r.x=Utils.getStageWidth()/2-o/2,r.y=.3*Utils.getStageHeight(),r.visible=!1,r.addEventListener("touchTap",this._restartGame,this),this._gameOverButton=r,this.addChild(r),[2]})})},t.prototype._startGame=function(){this._startButton.visible=!1,this._GameScreen.gameScene.gameStart()},t.prototype._restartGame=function(){this._startButton.visible=!0,this._gameOverButton.visible=!1,this._GameScreen.reset()},t.prototype._attachEvents=function(){this.addEventListener(GameEvents.PlayEvent.GAME_OVER,this._gameOver,this)},t.prototype._gameOver=function(e){this._gameOverButton.visible=!0},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,o=e.map(function(e){return i.parse(e)}),s=this.textfield,r=-1,n=function(){r++,r>=o.length&&(r=0);var e=o[r];s.textFlow=e;var i=egret.Tween.get(s);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(n,t)};n()},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Score=function(e){function t(){var t=e.call(this)||this;t._scorePrefix="Score: ",t._score=0;var i=20,o=35,s=Utils.createBitmapByName("bg_score_png");s.height=o,s.width=.7*Utils.getStageWidth(),s.x=(Utils.getStageWidth()-s.width)/2,s.y=i,t.addChild(s);var r=new egret.TextField;return r.width=Utils.getStageWidth(),r.y=i,r.height=o,r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.textColor=16777215,r.strokeColor=16773376,r.size=26,r.textFlow=[{text:t._scorePrefix,style:{size:24}},{text:t._score.toString(),style:{textColor:16773376}}],t._scoreText=r,t.addChild(t._scoreText),t}return __extends(t,e),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e,this._scoreText.textFlow=[{text:this._scorePrefix,style:{size:24}},{text:this._score.toString(),style:{textColor:16773376}}]},enumerable:!0,configurable:!0}),t}(egret.Sprite);__reflect(Score.prototype,"Score");var Service=function(){function e(e){this._baseURL="https://game.weiplus5.com/",this._gameConfig=this._baseURL+"index.php?m=game&f=index&v=public_load_dtwconfig",this._configrations=[{url:"index.php?m=game&f=index&v=public_load_dtwconfig",name:"gameConfig"}],this._loaded=0,this._loadingView=e}return e.prototype.getGameConfig=function(){var t=this;return new Promise(function(i){for(var o=function(o){t._loadingView.onRemoteProgress(o+1,t._configrations.length);var s=t._configrations[o];if(null==e.GAME_CONFIG||"gameConfig"!==s.name){var r=new egret.HttpRequest,n=function(t){switch(t.type){case egret.Event.COMPLETE:var o=t.currentTarget,r=JSON.parse(o.response);"gameConfig"===s.name&&(e.GAME_CONFIG=r),i(r);break;case egret.IOErrorEvent.IO_ERROR:i({message:"IO ERROR in"+s.name})}};r.once(egret.Event.COMPLETE,n,t),r.once(egret.IOErrorEvent.IO_ERROR,n,t),r.open(t._baseURL+s.url,egret.HttpMethod.GET),r.send()}else i(e.GAME_CONFIG)},s=0;s<t._configrations.length;s++)o(s)})},e}();__reflect(Service.prototype,"Service");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,o){function s(e){t.call(o,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(o))}var n=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},n)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var l=e.split("/");l.pop();var c=l.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(o,generateJSON.paths[e])},this):RES.getResByUrl(c,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(o,generateJSON.paths[e])},n)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Time;!function(e){var t=function(){function e(e,t){this._time=0,this._interval=1,this._times=e.times,this._timesRemains=e.times,this._callbackFinish=e.finish,this._scope=t,e.interval&&(this._interval=e.interval),e.tick&&(this._callbackTick=e.tick)}return e.prototype.run=function(){return null==this._timer?(this._timer=new egret.Timer(1e3*this._interval,this._times),this._timer.addEventListener(egret.TimerEvent.TIMER,this._tick,this),this._timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this._fini,this)):(this._timer.stop(),this._timesRemains=this._timesRemains+this._times,this._timer.repeatCount=this._timesRemains),console.log(this._timer.repeatCount),this._timer.start(),this._timer},e.prototype._tick=function(){this._timesRemains--,this._time=this._time+this._interval,this._callbackTick&&this._callbackTick.call(this._scope,this._time)},e.prototype._fini=function(){this.destroy(),this._callbackFinish.apply(this._scope)},e.prototype.destroy=function(){null!=this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this._tick,this),this._timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._fini,this),this._timer=null)},e}();e.StopWatch=t,__reflect(t.prototype,"Time.StopWatch");var i=function(){function e(e,t,i){this._time=e,this._scope=i,this._finish=t}return e.prototype.run=function(){this._nowTime=egret.getTimer(),egret.startTick(this._counter,this)},e.prototype._counter=function(e){var t=e,i=this._nowTime,o=t-i;return console.log(o),o>=this._time&&(egret.stopTick(this._counter,this),this._finish.call(this._scope)),!1},e}();e.Timer=i,__reflect(i.prototype,"Time.Timer")}(Time||(Time={}));var UIComponents;!function(e){var t=function(e){function t(t,i,o){var s=e.call(this)||this;return s.width=t,s.height=i,s._label=o,s.touchEnabled=!0,s.addEventListener(egret.Event.ADDED_TO_STAGE,s._onAddToStage,s),s}return __extends(t,e),t.prototype._onAddToStage=function(){var e=new egret.Bitmap;e.texture=RES.getRes("buttonBg_png");var t=new egret.Rectangle(30,35,196,33);e.scale9Grid=t,e.width=this.width,e.height=this.height,this.addChild(e);var i=new egret.TextField;i.width=this.width,i.height=this.height,i.textColor=TextColors.defaultButtonLable,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.text=this._label,i.bold=!0,this.addChild(i)},t}(egret.DisplayObjectContainer);e.DefaultButton=t,__reflect(t.prototype,"UIComponents.DefaultButton")}(UIComponents||(UIComponents={}));var Utils=function(){function e(){}return e.getBlockWidth=function(){if(0===e._blockWidth){var t=175/214,i=e.getBlockHeight()*t;e._blockWidth=i}return e._blockWidth},e.getBlockHeight=function(){return 0===e._blockHeight&&(e._blockHeight=Math.ceil((egret.MainContext.instance.stage.stageHeight-(e.verticalMarginTop+e.verticalMarginBottom))/this.rows)),e._blockHeight},e.getArenaHeight=function(){return e.getBlockHeight()*e.rows},e.getArenaWidth=function(){return e.getBlockWidth()*e.columns},e.getStageWidth=function(){return 0===e._stageWidth&&(e._stageWidth=egret.MainContext.instance.stage.stageWidth),e._stageWidth},e.getStageHeight=function(){return 0===e._stageHeight&&(e._stageHeight=egret.MainContext.instance.stage.stageHeight),e._stageHeight},e.getRowBlockState=function(t){if(null==e.rowsState[t]){for(var i=[],o=Math.floor(Math.random()*e.columns),s=0;s<e.columns;s++)s===o?i.push(BlockState.clickable):i.push(BlockState.unclickable);return e.rowsState[t]=i,i}return e.rowsState[t]},e.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.fitToWidth=function(e,t){e.width=t,e.height=t*e.texture.textureHeight/e.texture.textureWidth},e._blockWidth=0,e._blockHeight=0,e._stageHeight=0,e._stageWidth=0,e.verticalMarginTop=60,e.verticalMarginBottom=140,e.horizontalMargin=30,e.rowsState={},e.rows=6,e.columns=6,e.blockStyle="",e}();__reflect(Utils.prototype,"Utils");