var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(r,s){function n(t){try{a(o.next(t))}catch(e){s(e)}}function c(t){try{a(o["throw"](t))}catch(e){s(e)}}function a(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(n,c)}a((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(n=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,s=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(o){i=[6,o],s=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,s,n,c,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return c={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},BlockBase=function(t){function e(e){var i=t.call(this)||this;i.active=!1,i._unClickableColor=RES.getRes(BlockTexture.unClickable),i._blockMargin=2,i._blockPadding=3,i._currentState=e.state,i.shrinkRate=e.shrinkRate,i.width=e.width,i.height=e.height,i._shrinkWidth=(i.width-2*(i._blockPadding+i._blockMargin))*i.shrinkRate,i._shrinkHeight=(i.height-2*(i._blockPadding+i._blockMargin))*i.shrinkRate,i._colorRect=new egret.Bitmap,i._colorRect.width=i._shrinkWidth,i._colorRect.height=i._shrinkHeight,i._colorRect.touchEnabled=!0,i._backRect=Utils.createBitmapByName("blockFrame_png");var o=new egret.Rectangle(6,6,88,106);return i._backRect.scale9Grid=o,i._backRect.width=i.width-2*i._blockMargin,i._backRect.height=i.height-2*i._blockMargin,i._backRect.x=i._blockMargin,i._backRect.y=i._blockMargin,i._backRect.touchEnabled=!0,i._beforeDraw(),i._draw(),i._colorRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onTouch,i),i._backRect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i._onBackTouch,i),i}return __extends(e,t),e.prototype._draw=function(){null===this._backRect.parent&&this.addChild(this._backRect),this._colorRect.texture=this._clickableColor;var t=(BlockColor.border,this._shrinkWidth),e=this._shrinkHeight;this._currentState===BlockState.unclickable&&(t=this.width-2*(this._blockMargin+this._blockPadding),e=this.height-2*(this._blockMargin+this._blockPadding)),this._currentState===BlockState.clicked&&(t=this._colorRect.width,e=this._colorRect.height),this._currentState>0?this._colorRect.texture=this._clickableColor:this._colorRect.texture=this._unClickableColor,this._colorRect.x=(this.width-t)/2,this._colorRect.y=(this.height-e)/2,this._colorRect.width=t,this._colorRect.height=e,null===this._colorRect.parent&&this.addChild(this._colorRect)},e.prototype._onTouch=function(t){this.active&&(this._currentState===BlockState.clickable?this._hit():this._currentState===BlockState.unclickable&&this._hitUnclickable())},e.prototype._onBackTouch=function(t){this.active&&this._hitUnclickable()},e.prototype._hitAni=function(){var t=this._colorRect.width*this.shrinkRate,e=this._colorRect.height*this.shrinkRate;if(this._currentState===BlockState.unclickable&&(t=this._colorRect.width,e=this._colorRect.height),t>0){var i=t-6;this._colorRect.width=i>0?i:0}if(e>0){var o=e-8;this._colorRect.height=o>0?o:0}return 0===t&&0===e?(egret.stopTick(this._hitAni,this),this.removeChild(this._colorRect)):this._draw(),!1},e.prototype._hit=function(){egret.startTick(this._hitAni,this),this.state="clicked";var t=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT);this.dispatchEvent(t)},e.prototype._hitUnclickable=function(){var t=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_UNCLICKABLE);this.dispatchEvent(t)},e.prototype.move=function(t,e){void 0===e&&(e="down"),this.speed=t,this._dir=e,egret.startTick(this._moveBlock,this)},e.prototype.stop=function(){egret.stopTick(this._moveBlock,this)},e.prototype._moveBlock=function(t){return"down"===this._dir?this.y>=Utils.getArenaHeight()?this._triggerMovedOutEvent():this._setY():this.y<=-this.height?this._triggerMovedOutEvent():this._setY(),!1},e.prototype._setY=function(){var t=this.y;"up"===this._dir?this.y=t-this.speed:this.y=t+this.speed},e.prototype._triggerMovedOutEvent=function(){var t=!1,e=new GameEvents.BlockEvent(GameEvents.BlockEvent.MOVED_OUT);this._currentState===BlockState.clickable&&(t=!0),e.missed=t,this.dispatchEvent(e)},e.prototype.sizeUpdate=function(){this._shrinkWidth=this.width*this.shrinkRate-this._blockMargin,this._shrinkHeight=this.height*this.shrinkRate-this._blockMargin,this._currentState!==BlockState.clicked&&this._draw()},Object.defineProperty(e.prototype,"state",{get:function(){var t;return t=BlockState[this._currentState]},set:function(t){this._currentState=BlockState[t],this.graphics.clear(),this._draw()},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BlockBase.prototype,"BlockBase");var BlockFlashBase=function(t){function e(e){var i=t.call(this,e)||this;return i._activeState=!1,i}return __extends(e,t),e.prototype._beforeDraw=function(){this._clickableColor=RES.getRes(BlockTexture.clickableNormal)},e.prototype.move=function(e,i){void 0===i&&(i="down"),this._timeMark=egret.getTimer(),t.prototype.move.call(this,e,i)},e.prototype._moveBlock=function(e){var i=t.prototype._moveBlock.call(this,e);if("clickable"===this.state){var o=Math.floor((e-this._timeMark)/1e3);1===o&&(this._activeState=!this._activeState,this._activeState?this._clickableColor=this._activeColor:this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._draw(),this._timeMark=e)}return i},e}(BlockBase);__reflect(BlockFlashBase.prototype,"BlockFlashBase");var MagicBase=function(t){function e(){var e=t.call(this)||this;e._zoomRate=.4;var i=Utils.createBitmapByName("rock_bg_png");i.scaleX=e._zoomRate,i.scaleY=e._zoomRate,e._bg=i,e._drawIcon();var o=e._getIconOffset();return e.icon.x=-o.offsetX,i.y=o.offsetY,e.addChildAt(i,0),e}return __extends(e,t),e.prototype._drawIcon=function(){},e.prototype._getIconOffset=function(){},e.prototype.getBaseWidth=function(){return this._bg.width*this._zoomRate},e}(egret.Sprite);__reflect(MagicBase.prototype,"MagicBase");var Login=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.autoFitStage,e),e.addEventListener(eui.UIEvent.CREATION_COMPLETE,e.resize,e),e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.autoFitStage=function(){this.height=Utils.getStageHeight(),this.width=Utils.getStageWidth()},e.prototype.resize=function(){Utils.fitToWidth(this.bgIMG,this.width)},e}(eui.Component);__reflect(Login.prototype,"Login",["eui.UIComponent","egret.DisplayObject"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?o(r):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BlockNormal=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype._beforeDraw=function(){this._clickableColor=RES.getRes(BlockTexture.clickableNormal)},e}(BlockBase);__reflect(BlockNormal.prototype,"BlockNormal");var BlockRush=function(t){function e(e){var i=t.call(this,e)||this;return i._activeState=!1,i._activeColor=RES.getRes(BlockTexture.clickableRush),i}return __extends(e,t),e.prototype._beforeDraw=function(){this._clickableColor=RES.getRes(BlockTexture.clickableNormal)},e.prototype._hit=function(){if(t.prototype._hit.call(this),this._activeState){var e=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_RUSH);this.dispatchEvent(e)}},e.prototype.move=function(e,i){void 0===i&&(i="down"),this._timeMark=egret.getTimer(),t.prototype.move.call(this,e,i)},e.prototype._moveBlock=function(e){var i=t.prototype._moveBlock.call(this,e);if("clickable"===this.state){var o=Math.floor((e-this._timeMark)/1e3);1===o&&(this._activeState=!this._activeState,this._activeState?this._clickableColor=this._activeColor:this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._draw(),this._timeMark=e)}return i},e}(BlockBase);__reflect(BlockRush.prototype,"BlockRush");var BlocksColumn=function(t){function e(e){var i=t.call(this)||this;return i._blocks=[],i._initialBlocks=[],i._creatingRowIndex=0,i._speedLevel=0,i._speedTick=!1,i._shrinkRate=1,i.speed=Service.GAME_CONFIG.speedLevels[i._speedLevel],i.dir=e.dir,i._dir=i.dir,i.name=e.name,i.blockWeightNumber=e.blockWeightNumber,i._speedUpInterval=1e3*e.speedUpInterval,i._index=parseInt(i.name.split("_")[1],10),i._draw(),i}return __extends(e,t),e.prototype._draw=function(){this._blocks=[],this._initialBlocks=[];for(var t="down"===this._dir?-1:0,e="down"===this._dir?Utils.rows:Utils.rows+1,i=t;e>i;i++){var o=BlockState.unclickable;this._creatingRowIndex="down"===this._dir?i+1:i,("down"===this._dir&&-1===i||"up"===this._dir&&i===e-1)&&(o=Utils.getRowBlockState(this._creatingRowIndex)[this._index]);var r=this._createBlock({state:o,startBlock:!0});this.addChild(r),r.x=0,r.y=i*r.height,this._blocks.push(r),this._initialBlocks.push(r)}},e.prototype.reset=function(){this.stop(),this.speedLevel=0,this._dir=this.dir,this.shrinkReset();for(var t=this._blocks.length,e=0;t>e;e++)this.removeChild(this._blocks[e]),this._blocks[e]=null;this._draw()},e.prototype._createBlock=function(t){var e,i=Utils.getBlockWidth(),o=Utils.getBlockHeight(),r={width:i,height:o,shrinkRate:this._shrinkRate,state:t.state};if(null==t.startBlock&&t.state===BlockState.clickable){var s=[];for(var n in this._blockWeightNumber)if(this._blockWeightNumber.hasOwnProperty(n))for(var c=this._blockWeightNumber[n],a=0;c>a;a++)s.push(BlockType[n]);10!==s.length&&(s=[0,0,0,0,0,0,0,0,0,0]);var l=s,h=Math.floor(Math.random()*l.length),_=l[h];e=new window[BlockType[_]](r)}else e=new BlockNormal(r);return t.startBlock||(e.active=!0),e.addEventListener(GameEvents.BlockEvent.MOVED_OUT,this._onMovedOut,this),e},e.prototype._onMovedOut=function(t){var e=t.target,i=!1;if(e.removeEventListener(GameEvents.BlockEvent.MOVED_OUT,this._onMovedOut,this),"down"===this._dir?this._blocks.pop():this._blocks.shift(),e.stop(),this.removeChild(e),e=null,i)this.stop();else{var o=this._createBlock({state:Utils.getRowBlockState(this._creatingRowIndex)[this._index]});this._creatingRowIndex++,this.addChildAt(o,0),"down"===this._dir?o.y=this._blocks[0].y-o.height+this.speed:o.y=this._blocks[this._blocks.length-1].y+o.height-this.speed,o.move(this.speed,this._dir),"down"===this._dir?this._blocks.unshift(o):this._blocks.push(o)}},e.prototype._speedLooper=function(){this._speedTick?this._slowDown():this._speedUp()},e.prototype._speedUp=function(){this._speedLevel<Service.GAME_CONFIG.speedLevels.length&&(this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel],this.updateSpeed(),this._speedLevel++),this._speedLevel===Service.GAME_CONFIG.speedLevels.length&&(this._speedTick=!0)},e.prototype._slowDown=function(){this._speedLevel>0&&(this._speedLevel--,this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel],this.updateSpeed()),0===this._speedLevel&&(this._speedTick=!1,this._reversePause())},e.prototype._revertDir=function(){"up"===this._dir?this._dir="down":this._dir="up",this.move()},e.prototype._reversePause=function(){egret.startTick(this._checkPauseToFit,this)},e.prototype._checkPauseToFit=function(){var t=this._blocks.length,e=0;"down"===this._dir&&(e=t-1);var i="down"===this._dir&&this._blocks[e].y>=Utils.getArenaHeight(),o="up"===this._dir&&this._blocks[e].y<=-this._blocks[e].height;return(i||o)&&(egret.stopTick(this._checkPauseToFit,this),this._excuteReversePause()),!1},e.prototype._excuteReversePause=function(){this.stop(),console.log(this._blocks),null==this._reverseTimer&&(this._reverseTimer=new egret.Timer(2e3,1),this._reverseTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this._revertDir,this)),this._reverseTimer.reset(),this._reverseTimer.start()},e.prototype._blockSizeUpdate=function(){for(var t=0;t<this._blocks.length;t++){var e=this._blocks[t];e.shrinkRate=this._shrinkRate,e.sizeUpdate()}},e.prototype.updateSpeed=function(){for(var t=this._blocks,e=0;e<t.length;e++)t[e].speed=this.speed},e.prototype.startSpeedUpTimer=function(){this._speedUpTimer=new egret.Timer(this._speedUpInterval,0),this._speedUpTimer.addEventListener(egret.TimerEvent.TIMER,this._speedLooper,this),this._speedUpTimer.start()},e.prototype.stopSpeedUpTimer=function(){null!=this._speedUpTimer&&(this._speedUpTimer.stop(),this._speedUpTimer.removeEventListener(egret.TimerEvent.TIMER,this._speedLooper,this),this._speedUpTimer=null),this._speedTick=!1},e.prototype._stopReverseTimer=function(){null!=this._reverseTimer&&(this._reverseTimer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._revertDir,this),this._reverseTimer=null)},e.prototype.move=function(t){void 0===t&&(t=!1);for(var e=this._blocks,i=0;i<e.length;i++)e[i].move(this.speed,this._dir);if(t)for(var o=this._initialBlocks,i=0;i<o.length;i++)o[i].active=!0;this.startSpeedUpTimer()},e.prototype.stop=function(t){void 0===t&&(t=!1);for(var e=0;e<this._blocks.length;e++)this._blocks[e].stop(),t&&(this._blocks[e].active=!1);this.stopSpeedUpTimer(),this._stopReverseTimer()},e.prototype.shrink=function(){this._shrinkRate=.5,this._blockSizeUpdate()},e.prototype.shrinkReset=function(){this._shrinkRate=1,this._blockSizeUpdate()},Object.defineProperty(e.prototype,"speedLevel",{get:function(){return this._speedLevel},set:function(t){this._speedLevel=t,this.speed=Service.GAME_CONFIG.speedLevels[this._speedLevel]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blockWeightNumber",{get:function(){return this._blockWeightNumber},set:function(t){this._blockWeightNumber=t},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BlocksColumn.prototype,"BlocksColumn");var BlockShrink=function(t){function e(e){var i=t.call(this,e)||this;return i._activeColor=RES.getRes(BlockTexture.clickableShrink),i}return __extends(e,t),e.prototype._hit=function(){if(t.prototype._hit.call(this),this._activeState){var e=new GameEvents.BlockEvent(GameEvents.BlockEvent.HIT_SHRINK);this.dispatchEvent(e)}},e}(BlockFlashBase);__reflect(BlockShrink.prototype,"BlockShrink");var BlockState;!function(t){t[t.unclickable=0]="unclickable",t[t.clicked=1]="clicked",t[t.clickable=2]="clickable",t[t.clickableDouble=3]="clickableDouble",t[t.clickableRush=4]="clickableRush"}(BlockState||(BlockState={}));var BlockColor;!function(t){t[t.unClickable=16777215]="unClickable",t[t.clickable=0]="clickable",t[t.clicked=15066597]="clicked",t[t.border=6710886]="border",t[t.clickableDouble=1782970]="clickableDouble",t[t.clickableRush=12000541]="clickableRush",t[t.clickableBlink=9688320]="clickableBlink",t[t.clickableShrink=13172991]="clickableShrink"}(BlockColor||(BlockColor={}));var BlockTexture;!function(t){t.unClickable="b_normal_png",t.clicked="block_clicked",t.clickableDouble="b_blue_jpeg",t.clickableRush="b_red_jpeg",t.clickableBlink="b_green_jpeg",t.clickableShrink="b_purple_jpeg",t.clickableNormal="b_black_jpeg"}(BlockTexture||(BlockTexture={}));var BlockType;!function(t){t[t.BlockNormal=0]="BlockNormal",t[t.BlockDouble=1]="BlockDouble",t[t.BlockRush=2]="BlockRush",t[t.BlockBlink=3]="BlockBlink",t[t.BlockShrink=4]="BlockShrink",t[t.BlockBonus=5]="BlockBonus"}(BlockType||(BlockType={}));var GameMode;!function(t){t[t.BI_DIR=0]="BI_DIR",t[t.DOWN=1]="DOWN",t[t.UP=2]="UP"}(GameMode||(GameMode={}));var GameLevel;!function(t){t[t.EASY=0]="EASY",t[t.NORMAL=1]="NORMAL",t[t.HARD=2]="HARD"}(GameLevel||(GameLevel={}));var TextColors;!function(t){t[t.defaultButtonLable=16777215]="defaultButtonLable"}(TextColors||(TextColors={}));var GameEvents;!function(t){var e=function(t){function e(e,i,o){void 0===i&&(i=!0),void 0===o&&(o=!1);var r=t.call(this,e,i,o)||this;return r.missed=!1,r}return __extends(e,t),e.MOVED_OUT="movedout",e.MISSED="missed",e.HIT="hit",e.HIT_RUSH="hitrush",e.HIT_SHRINK="hitshrink",e.HIT_UNCLICKABLE="hitunclickable",e}(egret.Event);t.BlockEvent=e,__reflect(e.prototype,"GameEvents.BlockEvent");var i=function(t){function e(e,i,o){return void 0===i&&(i=!0),void 0===o&&(o=!1),t.call(this,e,i,o)||this}return __extends(e,t),e.GAME_OVER="gameover",e}(egret.Event);t.PlayEvent=i,__reflect(i.prototype,"GameEvents.PlayEvent")}(GameEvents||(GameEvents={}));var GameScene=function(t){function e(e){var i=t.call(this)||this;return i._blockColumns=[],i._columnSpeeds=[],i._difficulty=0,i._bgm=RES.getRes("lone-wolf-short"),i._stated=!1,i._mode=e.mode,i._level=e.level,i._rushFactor=Service.GAME_CONFIG.rushFactor,i._rushTime=Service.GAME_CONFIG.rushTime,i._shrinkTime=Service.GAME_CONFIG.shrinkTime,i._levelUpTime=Service.GAME_CONFIG.levelUpInterval,i._calculateColsRows(),i._drawColumns(),i.width=Utils.getArenaWidth(),i.height=Utils.getArenaHeight(),i.scrollRect=new egret.Rectangle(0,0,i.width,i.height),i.addEventListener(GameEvents.BlockEvent.MOVED_OUT,i._onMovedOut,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_RUSH,i._onHitRush,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_UNCLICKABLE,i._onHitUnclickable,i,!0),i.addEventListener(GameEvents.BlockEvent.HIT_SHRINK,i._onHitShrink,i,!0),document.addEventListener("pause",i._onPause.bind(i),!1),document.addEventListener("resume",i._onResume.bind(i),!1),i}return __extends(e,t),e.prototype._onPause=function(){this._stopbgm()},e.prototype._onResume=function(){this._stated&&this._playbgm()},e.prototype._drawColumns=function(){for(var t,e=["up","down"],i=Utils.getBlockWidth(),o=0;o<Utils.columns;o++){var r="up";this._mode===GameMode.BI_DIR?r=e[Math.floor(2*Math.random())]:this._mode===GameMode.DOWN&&(r=e[1]),t=new BlocksColumn({dir:r,speedUpInterval:Service.GAME_CONFIG.colmuns[o].interval,name:"col_"+o,blockWeightNumber:Service.GAME_CONFIG.difficulty[this._difficulty]}),t.x=o*i,t.width=i,this.addChildAt(t,1),this._blockColumns.push(t)}},e.prototype._calculateColsRows=function(){var t=48,e=48,i=Utils.getStageWidth(),o=Utils.getStageHeight(),r=Math.floor(i/t),s=Math.floor(o/e);this._level===GameLevel.EASY?(Utils.columns=4,Utils.rows=5):this._level===GameLevel.NORMAL?(Utils.columns=5,Utils.rows=7):this._level===GameLevel.HARD&&(Utils.columns=6,Utils.rows=8),Utils.columns>r&&(Utils.columns=r),Utils.rows>s&&(Utils.rows=s)},e.prototype._onMovedOut=function(t){},e.prototype._onHitRush=function(t){if(null==this._rushWatch){this._rushWatch=new Time.StopWatch({times:this._rushTime,finish:this._stopRush},this),this._columnSpeeds=[];for(var e=0;e<this._blockColumns.length;e++){var i=this._blockColumns[e].speed;this._columnSpeeds.push(i),this._blockColumns[e].speed=i*this._rushFactor,this._blockColumns[e].stopSpeedUpTimer(),this._blockColumns[e].updateSpeed()}}this._rushWatch.run();this._bg.texture=RES.getRes("rush_bg_png")},e.prototype._stopRush=function(){for(var t=0;t<this._blockColumns.length;t++){var e=this._columnSpeeds[t];this._blockColumns[t].speed=e,this._blockColumns[t].updateSpeed(),this._blockColumns[t].startSpeedUpTimer()}this._rushWatch=null,this._bg.texture=RES.getRes("normal_bg_png")},e.prototype._onHitUnclickable=function(){this._gameOver()},e.prototype._onHitShrink=function(){if(null==this._shrinkWatch){this._shrinkWatch=new Time.StopWatch({times:this._shrinkTime,finish:this._stopShrink},this);for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].shrink()}this._shrinkWatch.run()},e.prototype._stopShrink=function(){for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].shrinkReset();this._shrinkWatch=null},e.prototype.gameStart=function(){for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].move(!0);this._startLevelUp(),this._playbgm(),this._stated=!0},e.prototype._gameOver=function(){for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].stop(!0);var e=new GameEvents.PlayEvent(GameEvents.PlayEvent.GAME_OVER);this.dispatchEvent(e),this._stopbgm(),this._stated=!1},e.prototype._startLevelUp=function(){null==this._levelUpWatch&&(this._levelUpWatch=new Time.StopWatch({times:Service.GAME_CONFIG.difficulty.length,finish:this._stopLevelUp,interval:this._levelUpTime,tick:this.levelUp},this));this._levelUpWatch.run()},e.prototype._stopLevelUp=function(){this._levelUpWatch=null},e.prototype.levelUp=function(t){this._difficulty<Service.GAME_CONFIG.difficulty.length-1&&this._difficulty++,console.log(this._difficulty);for(var e=0;e<this._blockColumns.length;e++)this._blockColumns[e].blockWeightNumber=Service.GAME_CONFIG.difficulty[this._difficulty]},e.prototype._playbgm=function(){this._bgmChanel=this._bgm.play(0,0)},e.prototype._stopbgm=function(){this._bgmChanel.stop()},e.prototype.reset=function(){this._difficulty=0;for(var t=0;t<this._blockColumns.length;t++)this._blockColumns[t].blockWeightNumber=Service.GAME_CONFIG.difficulty[this._difficulty],this._blockColumns[t].reset();null!=this._rushWatch&&(this._rushWatch.destroy(),this._rushWatch=null,this._bg.texture=RES.getRes("normal_bg_png")),null!=this._shrinkWatch&&(this._shrinkWatch.destroy(),this._shrinkWatch=null),null!=this._levelUpWatch&&(this._levelUpWatch.destroy(),this._levelUpWatch=null)},e}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");var GameScreen=function(t){function e(e){void 0===e&&(e={});var i=t.call(this)||this;return i._drawBg(),i._drawGameScene(),i._drawScore(),i._drawMagics(),i.addEventListener(GameEvents.BlockEvent.HIT,i._onHit,i,!0),i.addEventListener(GameEvents.PlayEvent.GAME_OVER,i._gameOver,i),i}return __extends(e,t),e.prototype._drawBg=function(){this._bg=Utils.createBitmapByName("bg_png");var t=Utils.getStageWidth(),e=Utils.getStageHeight(),i=t/this._bg.texture.bitmapData.width,o=e/this._bg.texture.bitmapData.height;this._bg.width=t,this._bg.height=e,this.addChild(this._bg);var r=RES.getRes("shanguang_json"),s=RES.getRes("shanguang_png"),n=new egret.MovieClipDataFactory(r,s),c=new egret.MovieClip(n.generateMovieClipData("shanguang"));c.x=425*i,c.y=1415*o,c.scaleX=i,c.scaleY=o,this.addChild(c),c.gotoAndPlay("shan",-1)},e.prototype._drawGameScene=function(){var t=new GameScene({mode:GameMode.DOWN,level:GameLevel.EASY});this._gameScene=t,this._gameScene.x=(Utils.getStageWidth()-Utils.getArenaWidth())/2,this._gameScene.y=Utils.verticalMarginTop,this.addChild(t)},e.prototype._drawMagics=function(){var t=0;this._magicFreeze=new MagicFreeze;var e=this._magicFreeze.getBaseWidth(),i=(Utils.getStageWidth()-2*Utils.horizontalMargin-4*e)/3;this._magicFreeze.anchorOffsetY=this._magicFreeze.height,this._magicFreeze.x=t*(i+e)+Utils.horizontalMargin,this._magicFreeze.y=Utils.getStageHeight()-20,this.addChild(this._magicFreeze),t++,this._magicQuell=new MagicQuell,this._magicQuell.anchorOffsetY=this._magicQuell.height,this._magicQuell.x=t*(i+e)+Utils.horizontalMargin,this._magicQuell.y=Utils.getStageHeight()-20,this.addChild(this._magicQuell),t++,this._magicPurify=new MagicPurify,this._magicPurify.anchorOffsetY=this._magicPurify.height,this._magicPurify.x=t*(i+e)+Utils.horizontalMargin,this._magicPurify.y=Utils.getStageHeight()-20,this.addChild(this._magicPurify),t++,this._magicDestroy=new MagicDestroy,this._magicDestroy.anchorOffsetY=this._magicDestroy.height,this._magicDestroy.x=t*(i+e)+Utils.horizontalMargin,this._magicDestroy.y=Utils.getStageHeight()-20,this.addChild(this._magicDestroy)},e.prototype._onHit=function(t){this._score.score=this._score.score+1},e.prototype._drawScore=function(){this._score=new Score,this.addChild(this._score)},e.prototype._gameOver=function(){console.log(this._score.score)},e.prototype.reset=function(){this._score.score=0,this._gameScene.reset()},Object.defineProperty(e.prototype,"gameScene",{get:function(){return this._gameScene},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(GameScreen.prototype,"GameScreen");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading resources..."+t+"/"+e},e.prototype.onRemoteProgress=function(t,e){this.textField.text="Loading configuration..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var BlockBlink=function(t){function e(e){var i=t.call(this,e)||this;return i._activeState=!1,i}return __extends(e,t),e.prototype._beforeDraw=function(){this._clickableColor=RES.getRes(BlockTexture.clickableBlink)},e.prototype.move=function(e,i){void 0===i&&(i="down"),this._timeMark=egret.getTimer(),t.prototype.move.call(this,e,i)},e.prototype._moveBlock=function(e){var i=t.prototype._moveBlock.call(this,e);if("clicked"!==this.state){var o=Math.floor((e-this._timeMark)/1e3);1===o&&(this._activeState=!this._activeState,this._activeState?this.state="clickable":this.state="unclickable",this._timeMark=e)}return i},e}(BlockBase);__reflect(BlockBlink.prototype,"BlockBlink");var BlockDouble=function(t){function e(e){var i=t.call(this,e)||this;return i._clickCount=0,i}return __extends(e,t),e.prototype._beforeDraw=function(){this._clickableColor=RES.getRes(BlockTexture.clickableDouble)},e.prototype._onTouch=function(t){this._currentState===BlockState.clickable&&(this._clickCount++,1===this._clickCount?(this._clickableColor=RES.getRes(BlockTexture.clickableNormal),this._draw()):2===this._clickCount&&this._hit())},e}(BlockBase);__reflect(BlockDouble.prototype,"BlockDouble");var MagicDestroy=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._drawIcon=function(){var t=Utils.createBitmapByName("nuke_png");t.scaleX=this._zoomRate,t.scaleY=this._zoomRate,this.icon=t,this.addChild(t)},e.prototype._getIconOffset=function(){return{offsetX:12,offsetY:this.icon.height*this._zoomRate-12}},e}(MagicBase);__reflect(MagicDestroy.prototype,"MagicDestroy");var MagicFreeze=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._drawIcon=function(){var t=Utils.createBitmapByName("freeze_png");t.scaleX=this._zoomRate,t.scaleY=this._zoomRate,this.icon=t,this.addChild(t)},e.prototype._getIconOffset=function(){return{offsetX:15,offsetY:this.icon.height*this._zoomRate-19}},e}(MagicBase);__reflect(MagicFreeze.prototype,"MagicFreeze");var MagicPurify=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._drawIcon=function(){var t=Utils.createBitmapByName("purify_png");t.scaleX=this._zoomRate,t.scaleY=this._zoomRate,this.icon=t,this.addChild(t)},e.prototype._getIconOffset=function(){return{offsetX:3,offsetY:this.icon.height*this._zoomRate-12}},e}(MagicBase);__reflect(MagicPurify.prototype,"MagicPurify");var MagicQuell=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._drawIcon=function(){var t=Utils.createBitmapByName("skull_png");t.scaleX=this._zoomRate,t.scaleY=this._zoomRate,this.icon=t,this.addChild(t)},e.prototype._getIconOffset=function(){return{offsetX:3,offsetY:this.icon.height*this._zoomRate-12}},e}(MagicBase);__reflect(MagicQuell.prototype,"MagicQuell");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),[4,this.createGameScene()];case 2:return e.sent(),this._attachEvents(),[4,platform.login()];case 3:return e.sent(),[4,platform.getUserInfo()];case 4:return t=e.sent(),console.log(t),[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,o;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,this.loadTheme()];case 2:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return r.sent(),e=new Service(t),[4,e.getGameConfig()];case 4:return i=r.sent(),this.stage.removeChild(t),[3,6];case 5:return o=r.sent(),console.error(o),[3,6];case 6:return[2]}})})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,o,r,s;return __generator(this,function(n){return this.stage.setContentSize(window.innerWidth,window.innerHeight),this._GameScreen=new GameScreen,this.addChild(this._GameScreen),t=Utils.getStageWidth()/2,console.log(Utils.getStageWidth()),e=80,i=new UIComponents.DefaultButton(t,e,"Start"),i.x=Utils.getStageWidth()/2-t/2,i.y=.3*Utils.getStageHeight(),i.addEventListener("touchTap",this._startGame,this),this._startButton=i,this.addChild(i),o=Utils.getStageWidth()/2,r=80,s=new UIComponents.DefaultButton(o,r,"Game over"),s.x=Utils.getStageWidth()/2-o/2,s.y=.3*Utils.getStageHeight(),s.visible=!1,s.addEventListener("touchTap",this._restartGame,this),this._gameOverButton=s,this.addChild(s),[2]})})},e.prototype._startGame=function(){this._startButton.visible=!1,this._GameScreen.gameScene.gameStart()},e.prototype._restartGame=function(){this._startButton.visible=!0,this._gameOverButton.visible=!1,this._GameScreen.reset()},e.prototype._attachEvents=function(){this.addEventListener(GameEvents.PlayEvent.GAME_OVER,this._gameOver,this)},e.prototype._gameOver=function(t){this._gameOverButton.visible=!0},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,o=t.map(function(t){return i.parse(t)}),r=this.textfield,s=-1,n=function(){s++,s>=o.length&&(s=0);var t=o[s];r.textFlow=t;var i=egret.Tween.get(r);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(n,e)};n()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Score=function(t){function e(){var e=t.call(this)||this;e._scorePrefix="Score: ",e._score=0;var i=40,o=35,r=Utils.createBitmapByName("bg_score_png");r.height=o,r.width=.7*Utils.getStageWidth(),r.x=(Utils.getStageWidth()-r.width)/2,r.y=i,e.addChild(r);var s=new egret.TextField;return s.width=Utils.getStageWidth(),s.y=i,s.height=o,s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE,s.textColor=16777215,s.strokeColor=16773376,s.size=26,s.textFlow=[{text:e._scorePrefix,style:{size:24}},{text:e._score.toString(),style:{textColor:16773376}}],e._scoreText=s,e.addChild(e._scoreText),e
}return __extends(e,t),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this._scoreText.textFlow=[{text:this._scorePrefix,style:{size:24}},{text:this._score.toString(),style:{textColor:16773376}}]},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Score.prototype,"Score");var Service=function(){function t(t){this._baseURL="https://game.weiplus5.com/",this._gameConfig=this._baseURL+"index.php?m=game&f=index&v=public_load_dtwconfig",this._configrations=[{url:"index.php?m=game&f=index&v=public_load_dtwconfig",name:"gameConfig"}],this._loaded=0,this._loadingView=t}return t.prototype.getGameConfig=function(){var e=this;return new Promise(function(i){for(var o=function(o){e._loadingView.onRemoteProgress(o+1,e._configrations.length);var r=e._configrations[o];if(null==t.GAME_CONFIG||"gameConfig"!==r.name){var s=new egret.HttpRequest,n=function(e){switch(e.type){case egret.Event.COMPLETE:var o=e.currentTarget,s=JSON.parse(o.response);"gameConfig"===r.name&&(t.GAME_CONFIG=s),i(s);break;case egret.IOErrorEvent.IO_ERROR:i({message:"IO ERROR in"+r.name})}};s.once(egret.Event.COMPLETE,n,e),s.once(egret.IOErrorEvent.IO_ERROR,n,e),s.open(e._baseURL+r.url,egret.HttpMethod.GET),s.send()}else i(t.GAME_CONFIG)},r=0;r<e._configrations.length;r++)o(r)})},t}();__reflect(Service.prototype,"Service");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function r(t){e.call(o,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(o))}var n=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},n)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var c=t.split("/");c.pop();var a=c.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(o,generateJSON.paths[t])},this):RES.getResByUrl(a,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(o,generateJSON.paths[t])},n)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Time;!function(t){var e=function(){function t(t,e){this._time=0,this._interval=1,this._times=t.times,this._callbackFinish=t.finish,this._scope=e,t.interval&&(this._interval=t.interval),t.tick&&(this._callbackTick=t.tick)}return t.prototype.run=function(){return null==this._timer?(this._timer=new egret.Timer(1e3*this._interval,this._times),this._timer.addEventListener(egret.TimerEvent.TIMER,this._tick,this),this._timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this._fini,this)):(this._timer.stop(),this._timer.repeatCount=this._timer.repeatCount+this._times),this._timer.start(),this._timer},t.prototype._tick=function(){this._time=this._time+this._interval,this._callbackTick&&this._callbackTick.call(this._scope,this._time)},t.prototype._fini=function(){this.destroy(),this._callbackFinish.apply(this._scope)},t.prototype.destroy=function(){null!=this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this._tick,this),this._timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this._fini,this),this._timer=null)},t}();t.StopWatch=e,__reflect(e.prototype,"Time.StopWatch")}(Time||(Time={}));var UIComponents;!function(t){var e=function(t){function e(e,i,o){var r=t.call(this)||this;return r.width=e,r.height=i,r._label=o,r.touchEnabled=!0,r.addEventListener(egret.Event.ADDED_TO_STAGE,r._onAddToStage,r),r}return __extends(e,t),e.prototype._onAddToStage=function(){var t=new egret.Bitmap;t.texture=RES.getRes("buttonBg_png");var e=new egret.Rectangle(30,35,196,33);t.scale9Grid=e,t.width=this.width,t.height=this.height,this.addChild(t);var i=new egret.TextField;i.width=this.width,i.height=this.height,i.textColor=TextColors.defaultButtonLable,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.text=this._label,i.bold=!0,this.addChild(i)},e}(egret.DisplayObjectContainer);t.DefaultButton=e,__reflect(e.prototype,"UIComponents.DefaultButton")}(UIComponents||(UIComponents={}));var Utils=function(){function t(){}return t.getBlockWidth=function(){if(0===t._blockWidth){var e=175/214,i=t.getBlockHeight()*e;t._blockWidth=i}return t._blockWidth},t.getBlockHeight=function(){return 0===t._blockHeight&&(t._blockHeight=Math.ceil((egret.MainContext.instance.stage.stageHeight-(t.verticalMarginTop+t.verticalMarginBottom))/this.rows)),t._blockHeight},t.getArenaHeight=function(){return t.getBlockHeight()*t.rows},t.getArenaWidth=function(){return t.getBlockWidth()*t.columns},t.getStageWidth=function(){return 0===t._stageWidth&&(t._stageWidth=egret.MainContext.instance.stage.stageWidth),t._stageWidth},t.getStageHeight=function(){return 0===t._stageHeight&&(t._stageHeight=egret.MainContext.instance.stage.stageHeight),t._stageHeight},t.getRowBlockState=function(e){if(null==t.rowsState[e]){for(var i=[],o=Math.floor(Math.random()*t.columns),r=0;r<t.columns;r++)r===o?i.push(BlockState.clickable):i.push(BlockState.unclickable);return t.rowsState[e]=i,i}return t.rowsState[e]},t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.fitToWidth=function(t,e){t.width=e,t.height=e*t.texture.textureHeight/t.texture.textureWidth},t._blockWidth=0,t._blockHeight=0,t._stageHeight=0,t._stageWidth=0,t.verticalMarginTop=100,t.verticalMarginBottom=150,t.horizontalMargin=30,t.rowsState={},t.rows=6,t.columns=6,t}();__reflect(Utils.prototype,"Utils");